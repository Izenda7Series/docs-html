

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Modifying User Access Token &mdash; Izenda BI 3.2.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.png"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Izenda BI 3.2.1 documentation" href="../index.html"/>
        <link rel="up" title="Developer Guide" href=".developer_guide.html"/>
        <link rel="next" title="Location of CSS" href="code_bi_portal_custom_css.html"/>
        <link rel="prev" title="Modifying Default Email Template" href="code_default_email_template.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Izenda BI
          

          
            
            <img src="../_static/logo2.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                3.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/.intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/.install.html">Installation and Maintenance Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ui/.administrator_guide.html">Administrator Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ui/.user_guide.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href=".developer_guide.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href=".developer_guide.html#interacting-with-the-izenda-api">Interacting with the Izenda API</a></li>
<li class="toctree-l2"><a class="reference internal" href=".developer_guide.html#embedding-izenda">Embedding Izenda</a></li>
<li class="toctree-l2 current"><a class="reference internal" href=".developer_guide.html#customizing-your-izenda-instance">Customizing Your Izenda Instance</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href=".developer_guide.html#interfacing-with-izenda">Interfacing with Izenda</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href=".system_customization.html">Customizing System via Interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="code_default_email_template.html">Modifying Default Email Template</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Modifying User Access Token</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href=".developer_guide.html#styling-izenda">Styling Izenda</a></li>
<li class="toctree-l3"><a class="reference internal" href=".developer_guide.html#configuring-logging">Configuring Logging</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href=".developer_guide.html#redistributing-the-izenda-documentation">Redistributing the Izenda Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ref/.system_reference.html">System Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/.faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ref/.glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference external" href="http://wiki.izenda.us">6 Series Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Izenda BI</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href=".developer_guide.html">Developer Guide</a> &raquo;</li>
        
      <li>Modifying User Access Token</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/dev/code_modifying_user_access_token.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="modifying-user-access-token">
<h1>Modifying User Access Token<a class="headerlink" href="#modifying-user-access-token" title="Permalink to this headline">¶</a></h1>
<p>This article contains information on how to create custom properties and logic using the user&#8217;s access token. Custom properties can be useful for adding conditions to determine whether a user&#8217;s token is valid or for implementing hidden filters. Below is a general guide of how to perform these tasks. Note that this guide is not applicable to deployment mode 0.</p>
<div class="section" id="adding-a-custom-property-to-the-user-info">
<h2>Adding a custom property to the User Info<a class="headerlink" href="#adding-a-custom-property-to-the-user-info" title="Permalink to this headline">¶</a></h2>
<p>You can add your own custom property to the application&#8217;s UserInfo object, which is used to create the access token. Please note that this model is different from the User object native within Izenda.</p>
<blockquote>
<div><div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">class</span> <span class="nc">UserInfo</span>
<span class="p">{</span>
   <span class="k">public</span> <span class="kt">string</span> <span class="n">UserName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

   <span class="c1">// This corresponds to the &#39;TenantID&#39; field in the IzendaTenant table</span>
   <span class="k">public</span> <span class="kt">string</span> <span class="n">TenantUniqueName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

   <span class="c1">// add a custom property</span>
   <span class="k">public</span> <span class="kt">string</span> <span class="n">FavoriteGroup</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

   <span class="c1">// default constructor</span>
   <span class="k">public</span> <span class="nf">UserInfo</span><span class="p">()</span>
   <span class="p">{</span>
      <span class="c1">//Set our custom property for now, but in the future this can be set in a different place</span>
      <span class="n">FavoriteGroup</span> <span class="p">=</span> <span class="s">&quot;ID&quot;</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>After modifying the UserInfo object definition in your integrated environment, the new property can be set in various ways in your code. Below is an example of setting the property using the GenerateToken method.</p>
<blockquote>
<div><div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="na">[HttpGet]</span>
<span class="na">[Authorize]</span>
<span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">GenerateToken</span><span class="p">()</span>
<span class="p">{</span>
   <span class="kt">var</span> <span class="n">username</span> <span class="p">=</span> <span class="n">User</span><span class="p">.</span><span class="n">Identity</span><span class="p">.</span><span class="n">GetUserName</span><span class="p">();</span>
   <span class="kt">var</span> <span class="n">tenantName</span> <span class="p">=</span> <span class="p">((</span><span class="n">System</span><span class="p">.</span><span class="n">Security</span><span class="p">.</span><span class="n">Claims</span><span class="p">.</span><span class="n">ClaimsIdentity</span><span class="p">)</span><span class="n">User</span><span class="p">.</span><span class="n">Identity</span><span class="p">).</span><span class="n">FindFirstValue</span><span class="p">(</span><span class="s">&quot;tenantName&quot;</span><span class="p">);</span>
   <span class="kt">var</span> <span class="n">favoriteGroup</span> <span class="p">=</span> <span class="p">((</span><span class="n">System</span><span class="p">.</span><span class="n">Security</span><span class="p">.</span><span class="n">Claims</span><span class="p">.</span><span class="n">ClaimsIdentity</span><span class="p">)</span><span class="n">User</span><span class="p">.</span><span class="n">Identity</span><span class="p">).</span><span class="n">FindFirstValue</span><span class="p">(</span><span class="s">&quot;favoriteGroup&quot;</span><span class="p">);</span>

   <span class="kt">var</span> <span class="n">user</span> <span class="p">=</span> <span class="k">new</span> <span class="n">UserInfo</span> <span class="p">{</span> <span class="n">UserName</span> <span class="p">=</span> <span class="n">username</span><span class="p">,</span> <span class="n">TenantUniqueName</span> <span class="p">=</span> <span class="n">tenantName</span><span class="p">,</span> <span class="n">FavoriteGroup</span> <span class="p">=</span> <span class="n">favoriteGroup</span> <span class="p">};</span>
   <span class="kt">var</span> <span class="n">token</span> <span class="p">=</span> <span class="n">IzendaBoundary</span><span class="p">.</span><span class="n">IzendaTokenAuthorization</span><span class="p">.</span><span class="n">GetToken</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
   <span class="k">return</span> <span class="nf">Json</span><span class="p">(</span><span class="k">new</span> <span class="p">{</span> <span class="n">token</span> <span class="p">=</span> <span class="n">token</span> <span class="p">},</span> <span class="n">JsonRequestBehavior</span><span class="p">.</span><span class="n">AllowGet</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>In the above example, we are obtaining the value from the ClaimsIdentity used inside the application. Such a claim can be set when the user logs in or after selecting a specific option. Then any time the user accesses Izenda, the FavoriteGroup property in the UserInfo will be set and integrated into the access token. The FavoriteGroup property can then be used in the ValidateIzendaAuthToken route to perform custom logic.</p>
</div>
<div class="section" id="adding-decryption-logic-to-iadhocextension">
<h2>Adding decryption logic to IAdHocExtension<a class="headerlink" href="#adding-decryption-logic-to-iadhocextension" title="Permalink to this headline">¶</a></h2>
<p>If you are running a deployment mode 1 or 2 solution, you will need to add the same decryption logic used to decrypt the access token within the application to the IAdHocExtension solution. In this example, we will use the IzendaBoundary resources from the MVC5 starter kit. If you are running a deployment mode 3 solution, the IzendaBoundary resources and IAdHocExtension class will exist in the same solution and will thus be available in all contexts.</p>
<ul class="simple">
<li>If you are using the IAdHocExtension sample from the github repository, copy IzendaTokenAuthorization.cs, StringCipher.cs, and UserInfo.cs (located in the models sub-folder) from the IzendaBoundary folder in your MVC5 starter kit. You may need to change the namespaces on these files.<ul>
<li>IzendaTokenAuthorization.cs requires the Newtonsoft.Json NuGet package, so you will need to add the package to your IAdHocExtension solution (ensure it&#8217;s the same version as the one in the bin/Web.config of your MVC5 starter kit)</li>
<li>Add a reference to System.Configuration</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="retrieving-the-access-token-properties-from-the-hidden-filter-method">
<h2>Retrieving the access token properties from the hidden filter method<a class="headerlink" href="#retrieving-the-access-token-properties-from-the-hidden-filter-method" title="Permalink to this headline">¶</a></h2>
<p>You can now retrieve the access_token from the UserContext and decrypt it to view the custom property.</p>
<blockquote>
<div><div class="highlight-csharp"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">override</span> <span class="n">ReportFilterSetting</span> <span class="nf">SetHiddenFilters</span><span class="p">(</span><span class="n">SetHiddenFilterParam</span> <span class="n">param</span><span class="p">)</span>
<span class="p">{</span>
   <span class="c1">// Get the current user&#39;s access token</span>
   <span class="kt">var</span> <span class="n">currentAccessToken</span> <span class="p">=</span> <span class="n">UserContext</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">CurrentUser</span><span class="p">.</span><span class="n">CurrentAccessToken</span><span class="p">;</span>

   <span class="c1">// Get the UserInfo from the current access token</span>
   <span class="kt">var</span> <span class="n">userInfo</span> <span class="p">=</span> <span class="n">IzendaTokenAuthorization</span><span class="p">.</span><span class="n">GetUserInfo</span><span class="p">(</span><span class="n">currentAccessToken</span><span class="p">);</span>

   <span class="c1">// Retrieve the custom value</span>
   <span class="kt">var</span> <span class="n">myFavoriteGroup</span> <span class="p">=</span> <span class="n">userInfo</span><span class="p">.</span><span class="n">FavoriteGroup</span><span class="p">;</span>

   <span class="c1">//[...Hidden Filter Logic...]</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>Once you have decrypted the access token into a UserInfo object, you can use it in many different ways. We have only explored one example of a way the custom property can be retrieved and utilized to create custom behavior in Izenda. The goal of this exercise was to serve as a jumping off point for the basics. More complex behaviors can be derived from this sample as needed.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="code_bi_portal_custom_css.html" class="btn btn-neutral float-right" title="Location of CSS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="code_default_email_template.html" class="btn btn-neutral" title="Modifying Default Email Template" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Izenda.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'3.2.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-75560-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-75560-1');
</script>



</body>
</html>