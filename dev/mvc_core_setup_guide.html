

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>MVC Core Integration &mdash; Izenda BI 3.10.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.png"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Izenda BI 3.10.0 documentation" href="../index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Izenda BI
          

          
            
            <img src="../_static/logo2.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                3.10
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/.intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/.install.html">Installation and Maintenance Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ui/.administrator_guide.html">Administrator Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ui/.user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href=".developer_guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ref/.system_reference.html">System Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/.faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ref/.glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference external" href="http://wiki.izenda.us">6 Series Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Izenda BI</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>MVC Core Integration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/dev/mvc_core_setup_guide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mvc-core-integration">
<h1><a class="toc-backref" href="#id13">MVC Core Integration</a><a class="headerlink" href="#mvc-core-integration" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#mvc-core-integration" id="id13">MVC Core Integration</a><ul>
<li><a class="reference internal" href="#introduction" id="id14">Introduction</a></li>
<li><a class="reference internal" href="#prerequisites" id="id15">Prerequisites</a></li>
<li><a class="reference internal" href="#create-your-mvc-core-starter-kit-application" id="id16">Create Your MVC Core Starter Kit Application</a></li>
<li><a class="reference internal" href="#copying-izenda-resources-and-references" id="id17">Copying Izenda Resources and References</a></li>
<li><a class="reference internal" href="#configuring-the-project-build" id="id18">Configuring the Project Build</a><ul>
<li><a class="reference internal" href="#add-izenda-dlls-reference-and-other-dependencies" id="id19">Add Izenda DLLs reference and other dependencies</a></li>
<li><a class="reference internal" href="#adding-post-build-events-to-copy-the-resources" id="id20">Adding post build events to copy the resources</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-the-script-and-style-bundle" id="id21">Configuring the Script and Style Bundle</a></li>
<li><a class="reference internal" href="#configuring-the-routes" id="id22">Configuring the Routes</a></li>
<li><a class="reference internal" href="#setting-up-the-database" id="id23">Setting up the Database</a><ul>
<li><a class="reference internal" href="#create-izenda-db" id="id24">Create Izenda DB</a></li>
<li><a class="reference internal" href="#updating-the-izenda-db" id="id25">Updating the Izenda DB</a></li>
<li><a class="reference internal" href="#create-authentication-db" id="id26">Create Authentication DB</a></li>
<li><a class="reference internal" href="#verifying-izenda-db-and-authentication-db" id="id27">Verifying Izenda DB and Authentication DB</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-the-izenda-api-service" id="id28">Configuring the Izenda API Service</a><ul>
<li><a class="reference internal" href="#izenda-api-service-hosting-config" id="id29">Izenda API Service Hosting Config</a></li>
<li><a class="reference internal" href="#logging-config" id="id30">Logging Config</a></li>
<li><a class="reference internal" href="#configuring-database-connection" id="id31">Configuring Database Connection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-first-run-of-izenda-api-service" id="id32">The first run of Izenda API Service</a><ul>
<li><a class="reference internal" href="#bit-oracle-dll-dependencies" id="id33">64-bit Oracle DLL Dependencies</a></li>
<li><a class="reference internal" href="#run-starter-kit" id="id34">Run Starter Kit</a></li>
<li><a class="reference internal" href="#izenda-api-hosting-troubleshooting" id="id35">Izenda API Hosting Troubleshooting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-izenda-boundary" id="id36">Adding Izenda Boundary</a></li>
<li><a class="reference internal" href="#custom-authentication-logic" id="id37">Custom Authentication Logic</a><ul>
<li><a class="reference internal" href="#izendaconfig" id="id38">IzendaConfig</a></li>
<li><a class="reference internal" href="#izendauser-and-applicationuserclaimsprincipalfactory" id="id39">IzendaUser and ApplicationUserClaimsPrincipalFactory</a></li>
<li><a class="reference internal" href="#tenant" id="id40">Tenant</a></li>
<li><a class="reference internal" href="#applicationdbcontext" id="id41">ApplicationDBContext</a></li>
<li><a class="reference internal" href="#applicationusermanager" id="id42">ApplicationUserManager</a></li>
<li><a class="reference internal" href="#applicationsigninmanager" id="id43">ApplicationSignInManager</a></li>
<li><a class="reference internal" href="#account" id="id44">Account</a></li>
<li><a class="reference internal" href="#userinfo" id="id45">UserInfo</a></li>
<li><a class="reference internal" href="#inputmodel" id="id46">InputModel</a></li>
<li><a class="reference internal" href="#update-login-page" id="id47">Update Login Page</a></li>
</ul>
</li>
<li><a class="reference internal" href="#run-first-login" id="id48">Run First Login</a></li>
<li><a class="reference internal" href="#update-shared-layout" id="id49">Update Shared Layout</a><ul>
<li><a class="reference internal" href="#construct-izenda-menu-items" id="id50">Construct Izenda Menu Items</a></li>
<li><a class="reference internal" href="#implement-izenda-configuration-initialization" id="id51">Implement Izenda Configuration Initialization</a></li>
</ul>
</li>
<li><a class="reference internal" href="#embedding-front-end-izenda-izenda-ui" id="id52">Embedding Front-end Izenda (Izenda UI)</a><ul>
<li><a class="reference internal" href="#embedding-izenda-full-page" id="id53">Embedding Izenda full page</a></li>
<li><a class="reference internal" href="#embedding-specific-izenda-pages" id="id54">Embedding Specific Izenda Pages</a><ul>
<li><a class="reference internal" href="#embedding-the-izenda-settings-page" id="id55">Embedding the Izenda Settings Page</a></li>
<li><a class="reference internal" href="#embedding-the-izenda-report-list-page" id="id56">Embedding the Izenda Report List Page</a></li>
<li><a class="reference internal" href="#embedding-the-izenda-report-designer-page" id="id57">Embedding the Izenda Report Designer Page</a></li>
<li><a class="reference internal" href="#report-part-for-exporting" id="id58">Report Part for Exporting</a></li>
<li><a class="reference internal" href="#embedding-the-report-viewer" id="id59">Embedding the Report Viewer</a></li>
<li><a class="reference internal" href="#embedding-report-parts" id="id60">Embedding Report Parts</a></li>
</ul>
</li>
<li><a class="reference internal" href="#embedding-the-dashboard" id="id61">Embedding the Dashboard</a><ul>
<li><a class="reference internal" href="#dashboard-list" id="id62">Dashboard List</a></li>
<li><a class="reference internal" href="#new-dashboard" id="id63">New Dashboard</a></li>
<li><a class="reference internal" href="#dashboard-viewer" id="id64">Dashboard Viewer</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#run-your-izenda-integrated-application" id="id65">Run Your Izenda Integrated Application</a></li>
<li><a class="reference internal" href="#implement-register-new-account" id="id66">Implement Register New Account</a></li>
<li><a class="reference internal" href="#call-izenda-api-service-in-c" id="id67">Call Izenda API Service in C#</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id14">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This tutorial will teach you the basics of embedding Izenda into an ASP.NET MVC Core web application using Visual Studio 2017.</p>
<p>Download the <a class="reference external" href="https://github.com/Izenda7Series/MVCCoreStarterKit">completed project</a>. This is important! You’ll need to use files and code samples from this codebase throughout the guide.</p>
<p>This starter kit will guide you through the implementation and deployment of the full integration mode, this means both front-end (UI) and back-end (API Service) are integrated into one MVC 5 application.</p>
<p>See more details for <a class="reference internal" href="../intro/understanding_the_three-tiered_architecture.html#fully-integrated-deployment"><span class="std std-ref">Deployment Mode 1: Back End Standalone, Front End Integrated</span></a>.</p>
</div>
<div class="section" id="prerequisites">
<h2><a class="toc-backref" href="#id15">Prerequisites</a><a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>To complete this walkthrough, you will need the following:</p>
<ul class="simple">
<li>Visual Studio 2017</li>
<li>.NET Core 2.2</li>
<li>Izenda API package</li>
<li>Izenda Embedded UI package</li>
<li>Sql Server 2016</li>
</ul>
<p>The Izenda API service is built on .NET framework 4.6.1 and Core 2.2, you can build your integrated application on .NET Framework 4.0 or higher and .NET Core 2.2, this document will guide you step by step on integrating Izenda into your application with .NET Core 2.2. Please note this guide was developed using the versions of each component specified above. For more details on supported components please see other sections in the <a class="reference internal" href="../index.html"><span class="doc">Izenda documentation</span></a>.</p>
</div>
<div class="section" id="create-your-mvc-core-starter-kit-application">
<h2><a class="toc-backref" href="#id16">Create Your MVC Core Starter Kit Application</a><a class="headerlink" href="#create-your-mvc-core-starter-kit-application" title="Permalink to this headline">¶</a></h2>
<p>Open Visual Studio IDE then select menu New &gt; New Project</p>
<div class="figure" id="id1">
<a class="reference internal image-reference" href="../_images/mvc_core_new_project.PNG"><img alt="../_images/mvc_core_new_project.PNG" src="../_images/mvc_core_new_project.PNG" style="width: 627px;" /></a>
<p class="caption"><span class="caption-text">New ASP.NET Core Web Application</span></p>
</div>
<p>On New Project dialog, select Templates &gt; Visual C# &gt; Web then select target .NET Core Framework and ASP.NET Core Web Application.</p>
<p>Name your project “MvcCoreStarterKit” then click OK. This is important! It will affect reference names throughout the code base.</p>
<p>In the New ASP.NET Core Project dialog, choose .Net Core framework and ASP .NET Core 2.2 then click Web Application (Model-View-Controller).</p>
<div class="figure" id="id2">
<a class="reference internal image-reference" href="../_images/mvc_core_new_project_template.PNG"><img alt="../_images/mvc_core_new_project_template.PNG" src="../_images/mvc_core_new_project_template.PNG" style="width: 524px;" /></a>
<p class="caption"><span class="caption-text">MVC Core Template</span></p>
</div>
<p>The default template of MVC Core is created, you will use this template to implement Izenda integrated application from now.</p>
</div>
<div class="section" id="copying-izenda-resources-and-references">
<h2><a class="toc-backref" href="#id17">Copying Izenda Resources and References</a><a class="headerlink" href="#copying-izenda-resources-and-references" title="Permalink to this headline">¶</a></h2>
<p>In Solution Explorer of MvcCoreStarterKit project, add new folders below:</p>
<ul class="simple">
<li>IzendaBoundary</li>
<li>IzendaReferences</li>
<li>IzendaResources</li>
<li>wwwrootjsizenda</li>
</ul>
<p>Copy Izenda Resource to starter kit project:</p>
<ul class="simple">
<li>Download and copy <a class="reference external" href="https://github.com/Izenda7Series/MvcCoreStarterKit/blob/master/MvcCoreStarterKit/izendadb.config">izendadb.config</a> file into ~\MvcCoreStarterKit</li>
<li>Download latest Izenda API package (API.zip) extract zip file and then:<ul>
<li>Copy all sub folders and files in ~\API\bin to ~ \MvcCoreStarterKit\IzendaReferences</li>
<li>Copy 3 folders API\Content, API\EmailTemplates and API\Export to ~ \MvcCoreStarterKit\IzendaResources</li>
</ul>
</li>
<li>Download latest Izenda Embedded UI package (EmbeddedUI.zip), extract zip file then copy all sub folders and files to ~\MvcCoreStarterKit\Scripts\izenda</li>
<li>Download <a class="reference external" href="https://github.com/Izenda7Series/MvcCoreStarterKit/blob/master/MvcCoreStarterKit/Scripts/izenda.integrate.js">izenda.integrate.js</a>, <a class="reference external" href="https://github.com/Izenda7Series/Mvc5StarterKit/blob/master/Mvc5StarterKit/Scripts/izenda.utils.js">izenda.utils.js</a> and <a class="reference external" href="https://github.com/Izenda7Series/Mvc5StarterKit/blob/master/Mvc5StarterKit/Scripts/alertify.js">alertify.js</a> then copy to ~\MvcCoreStarterKit\wwwrootjs</li>
</ul>
</div>
<div class="section" id="configuring-the-project-build">
<h2><a class="toc-backref" href="#id18">Configuring the Project Build</a><a class="headerlink" href="#configuring-the-project-build" title="Permalink to this headline">¶</a></h2>
<div class="section" id="add-izenda-dlls-reference-and-other-dependencies">
<h3><a class="toc-backref" href="#id19">Add Izenda DLLs reference and other dependencies</a><a class="headerlink" href="#add-izenda-dlls-reference-and-other-dependencies" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Right click Reference node in MvcCoreStarterKit Solution Explorer then select Add Reference…</p>
</li>
<li><p class="first">On Reference Manager dialog click Browse… button then browse to folder ~\MvcCoreStarterKit\IzendaReferences, select all DLL files having <cite>Izenda</cite> prefix and <cite>Rhino.License.dll</cite> file</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In this step if you encounter errors regarding reference conflicts, you must configure Redirecting Assembly as required or contact Izenda Support.</p>
</div>
</li>
<li><p class="first">You also need to add System.ComponentModel.Composition. <br clear="right" />
Go to Add References again, Assemblies-&gt; Framework and check System.ComponentModel.Composition.</p>
</li>
<li><p class="first">Finally, go to Tools-&gt;NuGet Packet Manager-&gt;Package Manager Console and run the following:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">Install-Package Microsoft.AspNet.WebApi.Client</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="adding-post-build-events-to-copy-the-resources">
<h3><a class="toc-backref" href="#id20">Adding post build events to copy the resources</a><a class="headerlink" href="#adding-post-build-events-to-copy-the-resources" title="Permalink to this headline">¶</a></h3>
<p>Adding post build events to copy the resources
Open Project Properties page select Build Events then click Edit Post-build… button and then enter the commands below into Post-build event command line box:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">XCOPY /S /I /Y &quot;$(ProjectDir)IzendaResources\Content&quot; &quot;$(TargetDir)Content\&quot;</span>
<span class="go">XCOPY /S /I /Y &quot;$(ProjectDir)IzendaResources\EmailTemplates&quot; &quot;$(TargetDir)EmailTemplates\&quot;</span>
<span class="go">XCOPY /S /I /Y &quot;$(ProjectDir)IzendaResources\Export&quot; &quot;$(TargetDir)Export\&quot;</span>
<span class="go">XCOPY /S /I /Y &quot;$(ProjectDir)IzendaResources\Themes&quot; &quot;$(TargetDir)Themes\&quot;</span>
<span class="go">XCOPY /S /I /Y &quot;$(ProjectDir)IzendaReferences\Resources&quot; &quot;$(TargetDir)bin\Resources\&quot;</span>
</pre></div>
</div>
<div class="figure" id="id3">
<a class="reference internal image-reference" href="../_images/mvc_core_post_build_events.PNG"><img alt="../_images/mvc_core_post_build_events.PNG" src="../_images/mvc_core_post_build_events.PNG" style="width: 806px;" /></a>
<p class="caption"><span class="caption-text">Copy Resources on Post build event</span></p>
</div>
</div>
</div>
<div class="section" id="configuring-the-script-and-style-bundle">
<h2><a class="toc-backref" href="#id21">Configuring the Script and Style Bundle</a><a class="headerlink" href="#configuring-the-script-and-style-bundle" title="Permalink to this headline">¶</a></h2>
<p>Open ~\Views\Shared\_Layout.cshtml and add bundle script:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">charset</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;viewport&quot;</span> <span class="n">content</span><span class="o">=</span><span class="s2">&quot;width=device-width, initial-scale=1.0&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="nd">@ViewData</span><span class="p">[</span><span class="s2">&quot;Title&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">MVCCoreStarterKit</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">link</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;~/css/bootstrap.min.css&quot;</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">link</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;~/css/site.css&quot;</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">link</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;~/css/izenda_visualizations.css&quot;</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="o">/&gt;</span>
<span class="hll">    <span class="o">@*</span> <span class="n">Apply</span> <span class="n">css</span> <span class="n">based</span> <span class="n">on</span> <span class="n">the</span> <span class="n">users</span> <span class="n">tenant</span> <span class="o">*@</span>
</span><span class="hll">    <span class="o">&lt;</span><span class="n">link</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;~/js/izenda/izenda-ui.css&quot;</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="o">/&gt;</span>
</span><span class="hll">
</span><span class="hll">    <span class="o">@*</span><span class="n">Add</span> <span class="n">Custom</span> <span class="n">CSS</span> <span class="n">based</span> <span class="n">on</span> <span class="n">the</span> <span class="n">tenantId</span> <span class="ow">and</span> <span class="n">path</span> <span class="nb">set</span> <span class="ow">in</span> <span class="n">izendaCssPath</span> <span class="n">above</span> <span class="o">*@</span>
</span><span class="hll">    <span class="o">&lt;</span><span class="n">link</span> <span class="n">href</span><span class="o">=</span><span class="nd">@ViewBag</span><span class="o">.</span><span class="n">izendaCssPath</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span><span class="o">&gt;</span>
</span><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Then add the below script:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>        <span class="nd">@RenderBody</span><span class="p">()</span>
        <span class="o">&lt;</span><span class="n">footer</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">partial</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;_CopyRight&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;/</span><span class="n">footer</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">script</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;preload&quot;</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;~/js/jquery-1.10.2.min.js&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">script</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;preload&quot;</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;~/js/bootstrap.min.js&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">script</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;preload&quot;</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;~/js/site.js&quot;</span> <span class="n">asp</span><span class="o">-</span><span class="n">append</span><span class="o">-</span><span class="n">version</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="hll">    <span class="o">&lt;</span><span class="n">script</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;preload&quot;</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;~/js/alertify.js&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</span><span class="hll">    <span class="o">&lt;</span><span class="n">script</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;prefetch&quot;</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;~/js/izenda/izenda_common.js&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</span><span class="hll">    <span class="o">&lt;</span><span class="n">script</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;prefetch&quot;</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;~/js/izenda/izenda_locales.js&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</span><span class="hll">    <span class="o">&lt;</span><span class="n">script</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;prefetch&quot;</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;~/js/izenda/izenda_vendors.js&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</span><span class="hll">    <span class="o">&lt;</span><span class="n">script</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;prefetch&quot;</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;~/js/izenda/izenda_ui.js&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</span><span class="hll">    <span class="o">&lt;</span><span class="n">script</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;prefetch&quot;</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;~/js/izenda.integrate.js&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</span><span class="hll">    <span class="o">&lt;</span><span class="n">script</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;prefetch&quot;</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;~/js/izenda.utils.js&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</span><span class="hll">    <span class="o">&lt;</span><span class="n">script</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;prefetch&quot;</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;~/js/izenda_visualizations.js&quot;</span><span class="o">&gt;&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
</span>
</pre></div>
</div>
</div>
<div class="section" id="configuring-the-routes">
<h2><a class="toc-backref" href="#id22">Configuring the Routes</a><a class="headerlink" href="#configuring-the-routes" title="Permalink to this headline">¶</a></h2>
<p>Open ~\MvcCoreStarterKit\Startup.cs then modify the routing config as shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>            app.UseMvc(routes =&gt;
            {
                routes.MapRoute(&quot;ReportPart&quot;, &quot;viewer/reportpart/{id}&quot;, defaults: new { controller = &quot;Home&quot;, action = &quot;ReportPart&quot; });
                routes.MapRoute(&quot;ReportViewer&quot;, &quot;report/view/{id}&quot;, defaults: new { controller = &quot;Report&quot;, action = &quot;ReportViewer&quot; });
                routes.MapRoute(&quot;DashboardViewer&quot;, &quot;dashboard/edit/{id}&quot;, defaults: new { controller = &quot;Dashboard&quot;, action = &quot;DashboardViewer&quot; });
                routes.MapRoute(&quot;izenda&quot;, &quot;izenda&quot;, defaults: new { controller = &quot;Home&quot;, action = &quot;Izenda&quot; });
                routes.MapRoute(&quot;izenda_settings&quot;, &quot;izenda/settings&quot;, defaults: new { controller = &quot;Home&quot;, action = &quot;Izenda&quot; });
                routes.MapRoute(&quot;izenda_new&quot;, &quot;izenda/new&quot;, defaults: new { controller = &quot;Home&quot;, action = &quot;Izenda&quot; });
                routes.MapRoute(&quot;izenda_dashboard&quot;, &quot;izenda/dashboard&quot;, defaults: new { controller = &quot;Home&quot;, action = &quot;Izenda&quot; });
                routes.MapRoute(&quot;izenda_report&quot;, &quot;izenda/report&quot;, defaults: new { controller = &quot;Home&quot;, action = &quot;Izenda&quot; });
                routes.MapRoute(&quot;izenda_reportviewer&quot;, &quot;izenda/reportviewer&quot;, defaults: new { controller = &quot;Home&quot;, action = &quot;Izenda&quot; });
                routes.MapRoute(&quot;izenda_reportviewerpopup&quot;, &quot;izenda/reportviewerpopup&quot;, defaults: new { controller = &quot;Home&quot;, action = &quot;Izenda&quot; });
                routes.MapRoute(
                    name: &quot;default&quot;,
                    template: &quot;{controller=Home}/{action=Index}/{id?}&quot;);
            });
            app.UseOwin(x =&gt; x.UseNancy(opt =&gt; opt.Bootstrapper = new CustomBootstraper()));
        }
    }

    public class CustomBootstraper : IzendaBootstraper
    {
        protected override IEnumerable&lt;ModuleRegistration&gt; Modules
        {
            get
            {
                var nancyType = typeof(INancyModule);
                var moduleTypes = typeof(IzendaBootstraper).Assembly.GetTypes()
                    .Where(x =&gt; !x.IsAbstract &amp;&amp; x.GetInterfaces().Contains(nancyType))
                    .Select(x =&gt; new ModuleRegistration(x));
                return base.Modules.Concat(moduleTypes);
            }
        }
    }
}
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/Izenda7Series/Mvc5StarterKit/blob/master/Mvc5StarterKit/App_Start/RouteConfig.cs">View Code Here</a></p>
<p>The statement <code class="docutils literal"><span class="pre">app.UseOwin(x</span> <span class="pre">=&gt;</span> <span class="pre">x.UseNancy(opt</span> <span class="pre">=&gt;</span> <span class="pre">opt.Bootstrapper</span> <span class="pre">=</span> <span class="pre">new</span> <span class="pre">CustomBootstraper()));</span></code> and the <code class="docutils literal"><span class="pre">CustomBootstraper</span></code> class are important, do not miss it. This route will instruct MVC routine ignore any request API which is begin with <code class="docutils literal"><span class="pre">api/</span></code> prefix (instead of response as Controller and View request, it will treat as API Service request), and this prefix must be same with value of Izenda API prefix setting <code class="docutils literal"><span class="pre">&lt;add</span> <span class="pre">key=&quot;izendaapiprefix&quot;</span> <span class="pre">value=&quot;api&quot;</span> <span class="pre">/&gt;</span></code> that you will config in section <a class="reference internal" href="#izenda-api-service-hosting-config">Izenda API Service Hosting Config</a> later.</p>
<p>Some of the routing configuration may seem strange, but they will be explained later. The table below details the purpose of each URL route:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="15%" />
<col width="25%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">URL</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ReportPart</td>
<td>viewer/reportpart/{id}</td>
<td>This route is used by Izenda BE Service to capture html content of report party type chart, gauge or map. Mostly used for report exporting function</td>
</tr>
<tr class="row-odd"><td>ReportViewer</td>
<td>report/view/{id}</td>
<td>This route is used by Izenda BE Service to capture report content in html format. It is using in exporting report content to embedded html and send it to email (send to email directly or send by report subscription function)</td>
</tr>
<tr class="row-even"><td>DashboardViewer</td>
<td>dashboard/view/{id}</td>
<td>The route used by Izenda BE Service to capture dashboard content in html format. Using for exporting dashboard content to email.</td>
</tr>
<tr class="row-odd"><td>CustomAuth</td>
<td>api/user/login</td>
<td>The route used by the CopyConsole tool to login to your integrated Izenda API for executing Copy Management feature.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="setting-up-the-database">
<h2><a class="toc-backref" href="#id23">Setting up the Database</a><a class="headerlink" href="#setting-up-the-database" title="Permalink to this headline">¶</a></h2>
<p>In this starter kit, we use SQL Server for the database server. Izenda supports many database engines such as: [MSSQL] SQL Server, [AZSQL] AzureSQL, [MYSQL] MySQL, [ORACL] Oracle and [PGSQL] PostgreSQL. The steps to setting up these databases are similar.</p>
<div class="section" id="create-izenda-db">
<h3><a class="toc-backref" href="#id24">Create Izenda DB</a><a class="headerlink" href="#create-izenda-db" title="Permalink to this headline">¶</a></h3>
<p>On your SQL Server create an empty database named IzendaMvc. This database stores Izenda data (report definitions, dashboards, etc.) and the configuration necessary to run Izenda.</p>
<p>Download <a class="reference external" href="https://github.com/Izenda7Series/MVCCoreStarterKit/blob/master/SQLScript/MSSQL/IzendaMVC.sql">IzendaMvc.sql</a> then execute on IzendaMvc database to generate the schema and default data.</p>
</div>
<div class="section" id="updating-the-izenda-db">
<h3><a class="toc-backref" href="#id25">Updating the Izenda DB</a><a class="headerlink" href="#updating-the-izenda-db" title="Permalink to this headline">¶</a></h3>
<p>The IzendaMvc.sql script will generate a configuration database for Izenda 1.24.4.</p>
<p>If you use an EmbeddedUI and API for a later version of Izenda you will need to run update scripts against your IzendaMvc database.</p>
<p>Upgrade scripts can be compiled and downloaded using the <a class="reference external" href="https://tools.izenda.com/">Schema Migration Assistant</a> . Here, you will specify your current version (1.24.4) and your target version for upgrade and download the resulting SQL script.</p>
</div>
<div class="section" id="create-authentication-db">
<h3><a class="toc-backref" href="#id26">Create Authentication DB</a><a class="headerlink" href="#create-authentication-db" title="Permalink to this headline">¶</a></h3>
<p>On your SQL Server create an empty database named MvcCoreStarterKit. This database is used for storing user authentication information. In your real integrated application, it can be replaced by your system database with your custom user credential information.</p>
<p>Download <a class="reference external" href="https://github.com/Izenda7Series/MVCCoreStarterKit/blob/master/SQLScript/MSSQL/MVCCoreStarterKit.sql">MvcCoreStarterKit.sql</a> and execute on MvcCoreStarterKit database to create schema and default user authentication settings.</p>
</div>
<div class="section" id="verifying-izenda-db-and-authentication-db">
<h3><a class="toc-backref" href="#id27">Verifying Izenda DB and Authentication DB</a><a class="headerlink" href="#verifying-izenda-db-and-authentication-db" title="Permalink to this headline">¶</a></h3>
<p>After creating the IzendaDB, select all rows in the IzendaSystemSetting table and verify that the values are the same as below:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="15%" />
<col width="15%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>DeploymentMode</td>
<td>3</td>
<td>The setting for deployment mode, in this starter kit it is fully integrated.</td>
</tr>
<tr class="row-odd"><td>WebUrl</td>
<td><a class="reference external" href="http://localhost:14809/">http://localhost:14809/</a></td>
<td>The setting value must be base address of your front-end web page url.</td>
</tr>
</tbody>
</table>
<p>Next you must ensure the UserName value of records in AspNetUsers table in MvcCoreStarterKit DB must be matched with UserName value in IzendaUser table of IzendaMvc DB.</p>
</div>
</div>
<div class="section" id="configuring-the-izenda-api-service">
<h2><a class="toc-backref" href="#id28">Configuring the Izenda API Service</a><a class="headerlink" href="#configuring-the-izenda-api-service" title="Permalink to this headline">¶</a></h2>
<p>The full configuration files  <a class="reference external" href="https://github.com/Izenda7Series/MVCCoreStarterKit/blob/master/MVCCoreStarterKit/web.config">web.config</a>  and <a class="reference external" href="https://github.com/Izenda7Series/MVCCoreStarterKit/blob/master/MVCCoreStarterKit/appsettings.json">appsettings.json</a> of Izenda API Service are available on GitHub.</p>
<p><a class="reference external" href="https://github.com/Izenda7Series/Mvc5StarterKit/blob/master/Mvc5StarterKit/Web.config">View Code Here</a></p>
<div class="section" id="izenda-api-service-hosting-config">
<h3><a class="toc-backref" href="#id29">Izenda API Service Hosting Config</a><a class="headerlink" href="#izenda-api-service-hosting-config" title="Permalink to this headline">¶</a></h3>
<p>Open the MvcCoreStarterKit\Web.config and add below Izenda setting key into &lt;appSettings&gt; node:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span>  <span class="nt">&lt;appSettings&gt;</span>
    <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">&quot;webpages:Version&quot;</span> <span class="na">value=</span><span class="s">&quot;3.0.0.0&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">&quot;webpages:Enabled&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">&quot;ClientValidationEnabled&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">&quot;UnobtrusiveJavaScriptEnabled&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!--Izenda--&gt;</span>
    <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">&quot;izendaapiprefix&quot;</span> <span class="na">value=</span><span class="s">&quot;api&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">&quot;izedapassphrase&quot;</span> <span class="na">value=</span><span class="s">&quot;vqL7SF+9c9FIQEKUOhSZapacQgUQh&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">&quot;IzendaApiUrl&quot;</span> <span class="na">value=</span><span class="s">&quot;http://localhost:14809/api/&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">&quot;izusername&quot;</span> <span class="na">value=</span><span class="s">&quot;IzendaAdmin@system.com&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;add</span> <span class="na">key=</span><span class="s">&quot;iztenantname&quot;</span> <span class="na">value=</span><span class="s">&quot;&quot;</span> <span class="nt">/&gt;</span>
    <span class="c">&lt;!--Izenda End--&gt;</span>
  <span class="nt">&lt;/appSettings&gt;</span>
</pre></div>
</div>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="15%" />
<col width="20%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Key Name</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">izendaapiprefix</span></code></td>
<td>api</td>
<td>This is prefix of your Izenda API service, it is used for distinguish the Izenda API with other api in your application if it expose more than one service endpoint.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">izendapassphrase</span></code></td>
<td>vqL7SF+9c9FIQEKUOhSZapacQgUQh</td>
<td>The key used for encryption</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">IzendaApiUrl</span></code></td>
<td><a class="reference external" href="http://localhost:14809/api/">http://localhost:14809/api/</a></td>
<td>Your Izenda API endpoint, used to call the Izenda API in your .NET code</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">izusername</span></code></td>
<td><a class="reference external" href="mailto:IzendaAdmin&#37;&#52;&#48;system&#46;com">IzendaAdmin<span>&#64;</span>system<span>&#46;</span>com</a></td>
<td>Default system level account, in this kit it is used for authentication of specific functions like adding new users, updating the data model, etc. This value must match with the Username in MvcCoreStarterKit.AspNetUsers table and IzendaMvc.IzendaUser table</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">iztenantname</span></code></td>
<td>&#160;</td>
<td>The tenant of system level account, have same purpose with <code class="docutils literal"><span class="pre">izusername</span></code></td>
</tr>
</tbody>
</table>
<p>In &lt;system.webServer&gt; config node, add below config:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span>    <span class="nt">&lt;system.webServer&gt;</span>
      <span class="nt">&lt;handlers&gt;</span>
        <span class="nt">&lt;add</span> <span class="na">name=</span><span class="s">&quot;aspNetCore&quot;</span> <span class="na">path=</span><span class="s">&quot;*&quot;</span> <span class="na">verb=</span><span class="s">&quot;*&quot;</span> <span class="na">modules=</span><span class="s">&quot;AspNetCoreModule&quot;</span> <span class="na">resourceType=</span><span class="s">&quot;Unspecified&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/handlers&gt;</span>
      <span class="nt">&lt;aspNetCore</span> <span class="na">requestTimeout=</span><span class="s">&quot;00:20:00&quot;</span> <span class="na">processPath=</span><span class="s">&quot;dotnet&quot;</span> <span class="na">arguments=</span><span class="s">&quot;.\MVCCoreStarterKit.dll&quot;</span> <span class="na">stdoutLogEnabled=</span><span class="s">&quot;false&quot;</span> <span class="na">stdoutLogFile=</span><span class="s">&quot;.\logs\stdout&quot;</span> <span class="na">hostingModel=</span><span class="s">&quot;InProcess&quot;</span> <span class="nt">/&gt;</span>
	  <span class="nt">&lt;modules</span> <span class="na">runAllManagedModulesForAllRequests=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;remove</span> <span class="na">name=</span><span class="s">&quot;WebDAVModule&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- ADD THIS --&gt;</span>
    <span class="nt">&lt;/modules&gt;</span>
    <span class="nt">&lt;/system.webServer&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="logging-config">
<h3><a class="toc-backref" href="#id30">Logging Config</a><a class="headerlink" href="#logging-config" title="Permalink to this headline">¶</a></h3>
<p>In &lt;configSections&gt; add a new section named name=&#8221;log4net&#8221; to config logging for Izenda API.</p>
<p>Then add log4net node below:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span>  <span class="nt">&lt;log4net</span> <span class="na">threshold=</span><span class="s">&quot;ALL&quot;</span> <span class="na">debug=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;root&gt;</span>
      <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;OutputDebugStringAppender&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;RollingFileAppender&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/root&gt;</span>

    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;MVCCoreStarterKit&quot;</span> <span class="na">additivity=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;level</span> <span class="na">value=</span><span class="s">&quot;ALL&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;MVCCoreStarterKit&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/logger&gt;</span>

    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;RollingFileAppender&quot;</span> <span class="na">type=</span><span class="s">&quot;log4net.Appender.RollingFileAppender,log4net, Version=1.2.15.0, Culture=neutral, PublicKeyToken=669e0ddf0bb1aa2a&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;filter</span> <span class="na">type=</span><span class="s">&quot;log4net.Filter.LevelRangeFilter, log4net, Version=1.2.15.0, Culture=neutral, PublicKeyToken=669e0ddf0bb1aa2a&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;levelMin</span> <span class="na">value=</span><span class="s">&quot;INFO&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/filter&gt;</span>
      <span class="nt">&lt;file</span> <span class="na">value=</span><span class="s">&quot;logs\izenda-log.log&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;appendToFile</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;rollingStyle</span> <span class="na">value=</span><span class="s">&quot;Composite&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;datePattern</span> <span class="na">value=</span><span class="s">&quot;yyyyMMdd&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;staticLogFileName</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;preserveLogFileNameExtension</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;maximumFileSize</span> <span class="na">value=</span><span class="s">&quot;5MB&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;maxSizeRollBackups</span> <span class="na">value=</span><span class="s">&quot;1000&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;layout</span> <span class="na">type=</span><span class="s">&quot;log4net.Layout.PatternLayout,log4net, Version=1.2.15.0, Culture=neutral, PublicKeyToken=669e0ddf0bb1aa2a&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;ConversionPattern&quot;</span> <span class="na">value=</span><span class="s">&quot; %date [%-5thread][%-5level][%-36logger{1}] %message %newline&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/layout&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;MVCCoreStarterKit&quot;</span> <span class="na">type=</span><span class="s">&quot;log4net.Appender.FileAppender&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;file</span> <span class="na">value=</span><span class="s">&quot;logs\mvccorekit-log.log&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;appendToFile</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;layout</span> <span class="na">type=</span><span class="s">&quot;log4net.Layout.PatternLayout&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;conversionPattern</span> <span class="na">value=</span><span class="s">&quot;%date [%-5level] %message%newline&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/layout&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;OutputDebugStringAppender&quot;</span> <span class="na">type=</span><span class="s">&quot;log4net.Appender.OutputDebugStringAppender,log4net, Version=1.2.15.0, Culture=neutral, PublicKeyToken=669e0ddf0bb1aa2a&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;layout</span> <span class="na">type=</span><span class="s">&quot;log4net.Layout.PatternLayout,log4net, Version=1.2.15.0, Culture=neutral, PublicKeyToken=669e0ddf0bb1aa2a&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;ConversionPattern&quot;</span> <span class="na">value=</span><span class="s">&quot;[%-5level][%-24logger{1}/%line] %message (/T:%thread /D:%date) %newline&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/layout&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>
  <span class="nt">&lt;/log4net&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="configuring-database-connection">
<h3><a class="toc-backref" href="#id31">Configuring Database Connection</a><a class="headerlink" href="#configuring-database-connection" title="Permalink to this headline">¶</a></h3>
<p>Open ~\ MvcCoreStarterKit\izendadb.config then update the connection string to your IzendaMvc DB which was created in the steps above. For example with [MSSQL] SQLServer:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;ServerTypeId&quot;</span><span class="p">:</span><span class="s2">&quot;572bd576-8c92-4901-ab2a-b16e38144813&quot;</span><span class="p">,</span><span class="nt">&quot;ServerTypeName&quot;</span><span class="p">:</span><span class="s2">&quot;[MSSQL] SQLServer&quot;</span><span class="p">,</span><span class="nt">&quot;ConnectionString&quot;</span><span class="p">:</span><span class="s2">&quot;[your connection string to IzendaMvc]&quot;</span><span class="p">,</span><span class="nt">&quot;ConnectionId&quot;</span><span class="p">:</span><span class="s2">&quot;00000000-0000-0000-0000-000000000000&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">ServerTypeName</span></code> would be one of [MSSQL] SQL Server, [AZSQL] AzureSQL, [MYSQL] MySQL, [ORACL] Oracle and [PGSQL] PostgreSQL.</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">DatasourceName</th>
<th class="head">Id</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>[AZSQL] AzureSQL</td>
<td>d968e96f-91dc-414d-9fd8-aef2926c9a18</td>
</tr>
<tr class="row-odd"><td>[MYSQL] MySQL</td>
<td>3d4916d1-5a41-4b94-874f-5bedacb89656</td>
</tr>
<tr class="row-even"><td>[ORACL] Oracle</td>
<td>93942448-c715-4f98-85e2-9292ed7ca4bc</td>
</tr>
<tr class="row-odd"><td>[PGSQL] PostgreSQL</td>
<td>f2638ed5-70e5-47da-a052-4da0c1888fcf</td>
</tr>
<tr class="row-even"><td>[MSSQL] SQLServer</td>
<td>572bd576-8c92-4901-ab2a-b16e38144813</td>
</tr>
</tbody>
</table>
<p>For starter kit authentication database open ~\MvcCoreStarterKit\Web.config then modify the DefaultConnection value in connectionStrings node:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span>  <span class="nt">&lt;connectionStrings&gt;</span>
    <span class="nt">&lt;add</span> <span class="na">name=</span><span class="s">&quot;DefaultConnection&quot;</span> <span class="na">connectionString=</span><span class="s">&quot;[your connection string to MvcCoreStarterKit]&quot;</span> <span class="na">providerName=</span><span class="s">&quot;System.Data.SqlClient&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/connectionStrings&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-first-run-of-izenda-api-service">
<h2><a class="toc-backref" href="#id32">The first run of Izenda API Service</a><a class="headerlink" href="#the-first-run-of-izenda-api-service" title="Permalink to this headline">¶</a></h2>
<div class="section" id="bit-oracle-dll-dependencies">
<h3><a class="toc-backref" href="#id33">64-bit Oracle DLL Dependencies</a><a class="headerlink" href="#bit-oracle-dll-dependencies" title="Permalink to this headline">¶</a></h3>
<p>If you encounter an error related to OracleDataAccesssDTC in Visual Studio navigate to Tools -&gt; Options -&gt; Projects and Solutions -&gt; Web Projects -&gt; Turn on Use the 64 bit version of IIS Express for web sites and projects.</p>
<div class="figure" id="id4">
<a class="reference internal image-reference" href="../_images/mvc_core_64bit_iis_express.PNG"><img alt="../_images/mvc_core_64bit_iis_express.PNG" src="../_images/mvc_core_64bit_iis_express.PNG" style="width: 657px;" /></a>
<p class="caption"><span class="caption-text">64-bit IIS Express</span></p>
</div>
</div>
<div class="section" id="run-starter-kit">
<h3><a class="toc-backref" href="#id34">Run Starter Kit</a><a class="headerlink" href="#run-starter-kit" title="Permalink to this headline">¶</a></h3>
<p>In Visual Studio you can press F5 to run your starter kit for the first time, the application page will look like the screenshot below:</p>
<div class="figure" id="id5">
<a class="reference internal image-reference" href="_static/images/install/mvc_core_run_starter_kit.png"><img alt="_static/images/install/mvc_core_run_starter_kit.png" src="_static/images/install/mvc_core_run_starter_kit.png" style="width: 911px;" /></a>
<p class="caption"><span class="caption-text">Starter kit screen</span></p>
</div>
<p>There is nothing present from the Izenda UI at this time. At this step we are just checking whether Izenda API is able to start up completely or not. On your browser address add /api/ to the end of url (<a class="reference external" href="http://localhost:14809/api/">http://localhost:14809/api/</a>) then press enter, you will see Izenda API is hosted completely:</p>
<div class="figure" id="id6">
<a class="reference internal image-reference" href="../_images/mvc_core_landingpage.png"><img alt="../_images/mvc_core_landingpage.png" src="../_images/mvc_core_landingpage.png" style="width: 900px;" /></a>
<p class="caption"><span class="caption-text">Landing Page</span></p>
</div>
<p>In ~\MvcCoreStarterKit project folder you will see a logs folder with the log files mvccorekit-log.log (~\MvcCoreStarterKit\logs).</p>
</div>
<div class="section" id="izenda-api-hosting-troubleshooting">
<h3><a class="toc-backref" href="#id35">Izenda API Hosting Troubleshooting</a><a class="headerlink" href="#izenda-api-hosting-troubleshooting" title="Permalink to this headline">¶</a></h3>
<p>If you do not see logs file and landing page above check following:</p>
<ul class="simple">
<li>Nany hosting configuration in appsettings.json</li>
<li>Check your routing configuration in startup.cs</li>
</ul>
</div>
</div>
<div class="section" id="adding-izenda-boundary">
<h2><a class="toc-backref" href="#id36">Adding Izenda Boundary</a><a class="headerlink" href="#adding-izenda-boundary" title="Permalink to this headline">¶</a></h2>
<p>Get all files in <a class="reference external" href="https://bitbucket.org/izenda-development/mvccorestarterkit/src/master/MVCCoreStarterKit/IzendaBoundary/">IzendaBoundary</a> folder from GitHub repository then include into MvcCoreStarterKit project. Build the project, if there are any errors regarding missing references, update the references as needed.</p>
<p>The table below describes the functionality of each source code file:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">File and Folder</th>
<th class="head">Classes</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Models</td>
<td>Model Entity</td>
<td>The definition of transferring model data which is used when communicating between your code and Izenda API.</td>
</tr>
<tr class="row-odd"><td>CustomAdhocReport.cs</td>
<td>CustomAdhocReport</td>
<td>The IAdHocExtension is used to override many default functions in your Izenda installation. This extension will be automatically injected into the runtime by the Izenda API application. More information on this can be found <a class="reference internal" href="ref_iadhocextension.html"><span class="doc">here</span></a></td>
</tr>
<tr class="row-even"><td>IzendaTokenAuthorization.cs</td>
<td>IzendaTokenAuthorization</td>
<td>The helper class to decrypt and deserialize authentication token to UserInfo object and vice versa (serialize UserInfo object then encrypt to token key).</td>
</tr>
<tr class="row-odd"><td>IzendaUtility.cs</td>
<td>IzendaUtility</td>
<td>Helper class to get list of data connection info for specific tenant.</td>
</tr>
<tr class="row-even"><td>StringCipher.cs</td>
<td>StringCipher</td>
<td>The helper class to encrypt and decrypt string value.</td>
</tr>
<tr class="row-odd"><td>WebAPIService.cs</td>
<td>WebAPIService</td>
<td>The service proxy class supports to call to Izenda API Service.</td>
</tr>
</tbody>
</table>
<p>These classes just demonstrate simple examples of using each functionality. It is recommended that in your actual integration you use security best practices that follow your organizations established security policies and procedures.</p>
</div>
<div class="section" id="custom-authentication-logic">
<h2><a class="toc-backref" href="#id37">Custom Authentication Logic</a><a class="headerlink" href="#custom-authentication-logic" title="Permalink to this headline">¶</a></h2>
<p>In this starter kit, we use simple authentication with username, password and tenant info. Basically, authorization logic (role, permissions …etc.) will depend on implementation of Izenda backend.</p>
<p>In MvcCoreStarterKit database we add a table named Tenants and add a column named TenantID into AspNetUsers table, this new column is a foreign key reference to the Tenants table which demonstrates a one to many relationship between Tenant and User. Other tables are kept same as ASP.NET MVC 5 template, that helps us modify login logic at little as possible, but allows us to show a simple use case for multi-tenant support.</p>
<div class="figure" id="id7">
<a class="reference internal image-reference" href="../_images/mvc_AspNetUsers_Tenants.png"><img alt="../_images/mvc_AspNetUsers_Tenants.png" src="../_images/mvc_AspNetUsers_Tenants.png" style="width: 419px;" /></a>
<p class="caption"><span class="caption-text">Users and Tenants</span></p>
</div>
<p>In integrated mode, authentication is handled by the MVC Core application, not Izenda. In this starter kit, the Izenda backend will get a token via the <code class="docutils literal"><span class="pre">UserIntegrationConfig.GetAccessToken</span></code> method. You must implement your own code logic to provide this token containing the authenticated user’s information. To ensure security, each request to the Izenda API service will call back to MVC application to validate the token it received from the originating request. You must provide this validation logic in your app inside the <code class="docutils literal"><span class="pre">UserIntegrationConfig.ValidateToken</span></code> method. The diagram below illustrates the token retrieval and validation process in fully integrated mode:</p>
<div class="figure" id="id8">
<a class="reference internal image-reference" href="../_images/mvc_authentication_sequence_diagram.png"><img alt="../_images/mvc_authentication_sequence_diagram.png" src="../_images/mvc_authentication_sequence_diagram.png" style="width: 500px;" /></a>
<p class="caption"><span class="caption-text">Authentication Sequence Diagram</span></p>
</div>
<p>To customize the authentication logic, we must modify some existing classes in the ASP.NET MVC Core application template. The table below lists all the modified classes:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="30%" />
<col width="20%" />
<col width="5%" />
<col width="45%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">File</th>
<th class="head">Class</th>
<th class="head">State</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>IzendaConfig.cs</td>
<td>IzendaConfig</td>
<td>New</td>
<td>The extension class provides Izenda token and token validation for the Izenda backend.</td>
</tr>
<tr class="row-odd"><td>Areas\Identity\Model\IzendaUser.cs</td>
<td>ApplicationUser</td>
<td>New</td>
<td>The entity class present user identity model. This model maps to AspNetUsers table.</td>
</tr>
<tr class="row-even"><td>Areas\Identity\Model\Tenant.cs</td>
<td>Tenant</td>
<td>New</td>
<td>The entity model presents a tenant, maps to Tenants table.</td>
</tr>
<tr class="row-odd"><td>Data\ApplicationDbContext.cs</td>
<td>ApplicationDBContext</td>
<td>New</td>
<td>Entity Framework DB context.</td>
</tr>
<tr class="row-even"><td>Areas\Identity\ApplicationUserManager.cs</td>
<td>ApplicationUserManager</td>
<td>New</td>
<td>Manage authentication user and login context.</td>
</tr>
<tr class="row-odd"><td>Areas\Identity\ApplicationSignInManager.cs</td>
<td>ApplicationSignInManager</td>
<td>New</td>
<td>Custom sign in logic.</td>
</tr>
<tr class="row-even"><td>Areas\Identity\Pages\Account\Login.cshtml.cs</td>
<td>LoginModel</td>
<td>New</td>
<td>Custom login logic</td>
</tr>
<tr class="row-odd"><td>Areas\Identity\Pages\Account\Logout.cshtml.cs</td>
<td>LogoutModel</td>
<td>New</td>
<td>Custom logout logic</td>
</tr>
<tr class="row-even"><td>Areas\Identity\Pages\Account\Register.cshtml.cs</td>
<td>RegisterModel</td>
<td>New</td>
<td>Custom register logic</td>
</tr>
<tr class="row-odd"><td>Areas\Identity\ApplicationUserClaimsPrincipalFactory.cs</td>
<td>ApplicationUserClaimsPrincipalFactory</td>
<td>New</td>
<td>Handle user identity</td>
</tr>
</tbody>
</table>
<div class="section" id="izendaconfig">
<h3><a class="toc-backref" href="#id38">IzendaConfig</a><a class="headerlink" href="#izendaconfig" title="Permalink to this headline">¶</a></h3>
<p>Create IzendaConfig.cs file within the top level of the project and implement subscription for <code class="docutils literal"><span class="pre">UserIntegrationConfig.GetAccessToken</span></code> action and <code class="docutils literal"><span class="pre">UserIntegrationConfig.ValidateToken</span></code> action.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">public</span> <span class="n">static</span> <span class="k">class</span> <span class="nc">IzendaConfig</span>
    <span class="p">{</span>
        <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">RegisterLoginLogic</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="o">//</span><span class="n">This</span> <span class="ow">is</span> <span class="n">used</span> <span class="k">for</span> <span class="n">exporting</span> <span class="n">only</span>
<span class="hll">            <span class="n">UserIntegrationConfig</span><span class="o">.</span><span class="n">GetAccessToken</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">=&gt;</span>
</span>            <span class="p">{</span>
                <span class="k">return</span> <span class="n">IzendaTokenAuthorization</span><span class="o">.</span><span class="n">GetToken</span><span class="p">(</span><span class="n">new</span> <span class="n">UserInfo</span><span class="p">()</span>
                <span class="p">{</span>
                    <span class="n">UserName</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">UserName</span><span class="p">,</span>
                    <span class="n">TenantUniqueName</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">TenantId</span>
                <span class="p">});</span>
            <span class="p">};</span>

<span class="hll">            <span class="n">UserIntegrationConfig</span><span class="o">.</span><span class="n">ValidateToken</span> <span class="o">=</span> <span class="p">(</span><span class="n">ValidateTokenArgs</span> <span class="n">args</span><span class="p">)</span> <span class="o">=&gt;</span>
</span>            <span class="p">{</span>
                <span class="n">var</span> <span class="n">token</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">AccessToken</span><span class="p">;</span>
                <span class="n">var</span> <span class="n">user</span> <span class="o">=</span> <span class="n">IzendaTokenAuthorization</span><span class="o">.</span><span class="n">GetUserInfo</span><span class="p">(</span><span class="n">token</span><span class="p">);</span>

                <span class="o">//</span> <span class="n">TenantUniqueName</span> <span class="n">corresponds</span> <span class="n">to</span> <span class="n">the</span> <span class="s1">&#39;TenantID&#39;</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">IzendaTenant</span> <span class="n">table</span>
                <span class="k">return</span> <span class="n">new</span> <span class="n">ValidateTokenResult</span> <span class="p">{</span> <span class="n">UserName</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">UserName</span><span class="p">,</span> <span class="n">TenantUniqueName</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">TenantUniqueName</span> <span class="p">};</span>
            <span class="p">};</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>Action <code class="docutils literal"><span class="pre">UserIntegrationConfig.GetAccessToken</span></code> will convert user info to a token value.</p>
<p>Action <code class="docutils literal"><span class="pre">UserIntegrationConfig.ValidateToken</span></code> convert access token to user info.</p>
</div>
<div class="section" id="izendauser-and-applicationuserclaimsprincipalfactory">
<h3><a class="toc-backref" href="#id39">IzendaUser and ApplicationUserClaimsPrincipalFactory</a><a class="headerlink" href="#izendauser-and-applicationuserclaimsprincipalfactory" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Open Areas\IdentityModel\IzendaUser.cs</p>
</li>
<li><p class="first">Add the following namespaces so that it appears as below:</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">using</span> <span class="n">Microsoft</span><span class="o">.</span><span class="n">AspNetCore</span><span class="o">.</span><span class="n">Identity</span><span class="p">;</span>
<span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">ComponentModel</span><span class="o">.</span><span class="n">DataAnnotations</span><span class="o">.</span><span class="n">Schema</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Add Tenant_Id property like below:</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">public</span> <span class="k">class</span> <span class="nc">IzendaUser</span> <span class="p">:</span> <span class="n">IdentityUser</span>
    <span class="p">{</span>
<span class="hll">        <span class="n">public</span> <span class="nb">int</span> <span class="n">Tenant_Id</span> <span class="p">{</span> <span class="n">get</span><span class="p">;</span> <span class="nb">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class="hll">        <span class="p">[</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;Tenant_Id&quot;</span><span class="p">)]</span>
</span><span class="hll">        <span class="n">public</span> <span class="n">Tenant</span> <span class="n">Tenant</span> <span class="p">{</span> <span class="n">get</span><span class="p">;</span> <span class="nb">set</span><span class="p">;</span> <span class="p">}</span>
</span>    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Open Areas\IdentityApplicationUserClaimsPrincipalFactory.cs</p>
</li>
<li><p class="first">Add the following namespaces so that it appears as below:</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">using</span> <span class="n">Microsoft</span><span class="o">.</span><span class="n">AspNetCore</span><span class="o">.</span><span class="n">Identity</span><span class="p">;</span>
<span class="n">using</span> <span class="n">Microsoft</span><span class="o">.</span><span class="n">Extensions</span><span class="o">.</span><span class="n">Options</span><span class="p">;</span>
<span class="n">using</span> <span class="n">MVCCoreStarterKit</span><span class="o">.</span><span class="n">Areas</span><span class="o">.</span><span class="n">Identity</span><span class="o">.</span><span class="n">Model</span><span class="p">;</span>
<span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Linq</span><span class="p">;</span>
<span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Security</span><span class="o">.</span><span class="n">Claims</span><span class="p">;</span>
<span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Threading</span><span class="o">.</span><span class="n">Tasks</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Add custom claim identity like below:</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>        <span class="n">protected</span> <span class="n">override</span> <span class="k">async</span> <span class="n">Task</span><span class="o">&lt;</span><span class="n">ClaimsIdentity</span><span class="o">&gt;</span> <span class="n">GenerateClaimsAsync</span><span class="p">(</span><span class="n">IzendaUser</span> <span class="n">user</span><span class="p">)</span>
        <span class="p">{</span>
<span class="hll">            <span class="n">var</span> <span class="n">identity</span> <span class="o">=</span> <span class="k">await</span> <span class="n">base</span><span class="o">.</span><span class="n">GenerateClaimsAsync</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
</span><span class="hll">
</span><span class="hll">            <span class="n">var</span> <span class="n">tenant</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">Tenant</span><span class="p">;</span>
</span><span class="hll">            <span class="k">if</span> <span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">Tenant</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span>
</span><span class="hll">            <span class="p">{</span>
</span><span class="hll">                <span class="n">identity</span><span class="o">.</span><span class="n">AddClaims</span><span class="p">(</span><span class="n">new</span><span class="p">[]</span> <span class="p">{</span>
</span><span class="hll">                    <span class="n">new</span> <span class="n">Claim</span><span class="p">(</span><span class="s2">&quot;tenantName&quot;</span><span class="p">,</span><span class="n">tenant</span><span class="o">.</span><span class="n">Name</span><span class="p">),</span>
</span><span class="hll">                    <span class="n">new</span> <span class="n">Claim</span><span class="p">(</span><span class="s2">&quot;tenantId&quot;</span><span class="p">,</span><span class="n">tenant</span><span class="o">.</span><span class="n">Id</span><span class="o">.</span><span class="n">ToString</span><span class="p">()),</span>
</span><span class="hll">                <span class="p">});</span>
</span><span class="hll">            <span class="p">}</span>
</span><span class="hll">            <span class="n">var</span> <span class="n">role</span> <span class="o">=</span> <span class="k">await</span> <span class="n">UserManager</span><span class="o">.</span><span class="n">GetRolesAsync</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
</span><span class="hll">            <span class="n">identity</span><span class="o">.</span><span class="n">AddClaim</span><span class="p">(</span><span class="n">new</span> <span class="n">Claim</span><span class="p">(</span><span class="n">ClaimsIdentity</span><span class="o">.</span><span class="n">DefaultRoleClaimType</span><span class="p">,</span> <span class="n">role</span><span class="o">.</span><span class="n">FirstOrDefault</span><span class="p">()));</span>
</span><span class="hll">
</span><span class="hll">            <span class="k">return</span> <span class="n">identity</span><span class="p">;</span>
</span>        <span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>The ApplicationUser class represents the user model and maps to AspNetUsers table. The Tenant_Id property is the foreign key reference to the tenant of the user. In the <code class="docutils literal"><span class="pre">GenerateClaimsAsync</span></code> method we add tenantId into user identity, this value will be used to establish “claims” based on the user’s tenant.</p>
</div>
<div class="section" id="tenant">
<h3><a class="toc-backref" href="#id40">Tenant</a><a class="headerlink" href="#tenant" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Open Areas\Identity\Model\Tenant.cs.</li>
<li>Add a new Tenant class to represent a tenant object. This class is an entity model that maps to the Tenants table. The example below utilizes a very simple tenant model. You can customize this model to store more complex information.</li>
</ol>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">namespace</span> <span class="n">MVCCoreStarterKit</span><span class="o">.</span><span class="n">Areas</span><span class="o">.</span><span class="n">Identity</span><span class="o">.</span><span class="n">Model</span>
<span class="p">{</span>
    <span class="n">public</span> <span class="k">class</span> <span class="nc">Tenant</span>
    <span class="p">{</span>
        <span class="n">public</span> <span class="nb">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="n">get</span><span class="p">;</span> <span class="nb">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="n">public</span> <span class="n">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="n">get</span><span class="p">;</span> <span class="nb">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="applicationdbcontext">
<h3><a class="toc-backref" href="#id41">ApplicationDBContext</a><a class="headerlink" href="#applicationdbcontext" title="Permalink to this headline">¶</a></h3>
<p>This is the Entity Framework DB context of the entire authentication database. Because we added a new Tenants table, we must update the DB context to set of Tenant into this class.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">public</span> <span class="k">class</span> <span class="nc">ApplicationDbContext</span> <span class="p">:</span> <span class="n">IdentityDbContext</span><span class="o">&lt;</span><span class="n">IzendaUser</span><span class="o">&gt;</span>
    <span class="p">{</span>
        <span class="n">public</span> <span class="n">DbSet</span><span class="o">&lt;</span><span class="n">Tenant</span><span class="o">&gt;</span> <span class="n">Tenants</span> <span class="p">{</span> <span class="n">get</span><span class="p">;</span> <span class="nb">set</span><span class="p">;</span> <span class="p">}</span>


        <span class="n">public</span> <span class="n">ApplicationDbContext</span><span class="p">(</span><span class="n">DbContextOptions</span><span class="o">&lt;</span><span class="n">ApplicationDbContext</span><span class="o">&gt;</span> <span class="n">options</span><span class="p">)</span>
            <span class="p">:</span> <span class="n">base</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>


        <span class="n">protected</span> <span class="n">override</span> <span class="n">void</span> <span class="n">OnModelCreating</span><span class="p">(</span><span class="n">ModelBuilder</span> <span class="n">builder</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">base</span><span class="o">.</span><span class="n">OnModelCreating</span><span class="p">(</span><span class="n">builder</span><span class="p">);</span>
            <span class="o">//</span> <span class="n">Customize</span> <span class="n">the</span> <span class="n">ASP</span><span class="o">.</span><span class="n">NET</span> <span class="n">Identity</span> <span class="n">model</span> <span class="ow">and</span> <span class="n">override</span> <span class="n">the</span> <span class="n">defaults</span> <span class="k">if</span> <span class="n">needed</span><span class="o">.</span>
            <span class="o">//</span> <span class="n">For</span> <span class="n">example</span><span class="p">,</span> <span class="n">you</span> <span class="n">can</span> <span class="n">rename</span> <span class="n">the</span> <span class="n">ASP</span><span class="o">.</span><span class="n">NET</span> <span class="n">Identity</span> <span class="n">table</span> <span class="n">names</span> <span class="ow">and</span> <span class="n">more</span><span class="o">.</span>
            <span class="o">//</span> <span class="n">Add</span> <span class="n">your</span> <span class="n">customizations</span> <span class="n">after</span> <span class="n">calling</span> <span class="n">base</span><span class="o">.</span><span class="n">OnModelCreating</span><span class="p">(</span><span class="n">builder</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="applicationusermanager">
<h3><a class="toc-backref" href="#id42">ApplicationUserManager</a><a class="headerlink" href="#applicationusermanager" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Open Areas\Identity\ApplicationUserManager.cs</p>
</li>
<li><p class="first">Add the following namespaces so that it appears as below:</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">using</span> <span class="n">Microsoft</span><span class="o">.</span><span class="n">AspNetCore</span><span class="o">.</span><span class="n">Identity</span><span class="p">;</span>
<span class="n">using</span> <span class="n">Microsoft</span><span class="o">.</span><span class="n">EntityFrameworkCore</span><span class="p">;</span>
<span class="n">using</span> <span class="n">Microsoft</span><span class="o">.</span><span class="n">Extensions</span><span class="o">.</span><span class="n">Logging</span><span class="p">;</span>
<span class="n">using</span> <span class="n">Microsoft</span><span class="o">.</span><span class="n">Extensions</span><span class="o">.</span><span class="n">Options</span><span class="p">;</span>
<span class="n">using</span> <span class="n">MVCCoreStarterKit</span><span class="o">.</span><span class="n">Areas</span><span class="o">.</span><span class="n">Identity</span><span class="o">.</span><span class="n">Model</span><span class="p">;</span>
<span class="n">using</span> <span class="n">MVCCoreStarterKit</span><span class="o">.</span><span class="n">Data</span><span class="p">;</span>
<span class="n">using</span> <span class="n">System</span><span class="p">;</span>
<span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Collections</span><span class="o">.</span><span class="n">Generic</span><span class="p">;</span>
<span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Linq</span><span class="p">;</span>
<span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Threading</span><span class="o">.</span><span class="n">Tasks</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Add a new method <code class="docutils literal"><span class="pre">FindTenantUserAsync</span></code>. This will be used to query and retrieve users by tenant, username, and password.</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>        <span class="n">public</span> <span class="k">async</span> <span class="n">Task</span><span class="o">&lt;</span><span class="n">IzendaUser</span><span class="o">&gt;</span> <span class="n">FindTenantUserAsync</span><span class="p">(</span><span class="n">string</span> <span class="n">tenant</span><span class="p">,</span> <span class="n">string</span> <span class="n">username</span><span class="p">,</span> <span class="n">string</span> <span class="n">password</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">var</span> <span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="n">dbContext</span><span class="o">.</span><span class="n">Users</span>
                <span class="o">.</span><span class="n">Include</span><span class="p">(</span><span class="n">x</span> <span class="o">=&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">Tenant</span><span class="p">)</span>
                <span class="o">.</span><span class="n">Where</span><span class="p">(</span><span class="n">x</span> <span class="o">=&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">UserName</span><span class="o">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">StringComparison</span><span class="o">.</span><span class="n">InvariantCultureIgnoreCase</span><span class="p">))</span>
                <span class="o">.</span><span class="n">Where</span><span class="p">(</span><span class="n">x</span> <span class="o">=&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">Tenant</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">tenant</span><span class="p">,</span> <span class="n">StringComparison</span><span class="o">.</span><span class="n">InvariantCultureIgnoreCase</span><span class="p">))</span>
                <span class="o">.</span><span class="n">SingleOrDefaultAsync</span><span class="p">();</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">await</span> <span class="n">CheckPasswordAsync</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">user</span><span class="p">;</span>

            <span class="k">return</span> <span class="n">null</span><span class="p">;</span>
        <span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="applicationsigninmanager">
<h3><a class="toc-backref" href="#id43">ApplicationSignInManager</a><a class="headerlink" href="#applicationsigninmanager" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Open Areas\Identity\ApplicationSignInManager.cs</p>
</li>
<li><p class="first">Add the following namespaces so that it appears as below:</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">using</span> <span class="n">Microsoft</span><span class="o">.</span><span class="n">AspNetCore</span><span class="o">.</span><span class="n">Authentication</span><span class="p">;</span>
<span class="n">using</span> <span class="n">Microsoft</span><span class="o">.</span><span class="n">AspNetCore</span><span class="o">.</span><span class="n">Http</span><span class="p">;</span>
<span class="n">using</span> <span class="n">Microsoft</span><span class="o">.</span><span class="n">AspNetCore</span><span class="o">.</span><span class="n">Identity</span><span class="p">;</span>
<span class="n">using</span> <span class="n">Microsoft</span><span class="o">.</span><span class="n">Extensions</span><span class="o">.</span><span class="n">Logging</span><span class="p">;</span>
<span class="n">using</span> <span class="n">Microsoft</span><span class="o">.</span><span class="n">Extensions</span><span class="o">.</span><span class="n">Options</span><span class="p">;</span>
<span class="n">using</span> <span class="n">MVCCoreStarterKit</span><span class="o">.</span><span class="n">Areas</span><span class="o">.</span><span class="n">Identity</span><span class="o">.</span><span class="n">Model</span><span class="p">;</span>
<span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Threading</span><span class="o">.</span><span class="n">Tasks</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Add a new method <code class="docutils literal"><span class="pre">PasswordSigninAsync</span></code> to customize sign in logic. This method utilizes the FindTenantUserAsync method added above to find a user with the specified username, password and tenant.</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>        <span class="n">public</span> <span class="k">async</span> <span class="n">Task</span><span class="o">&lt;</span><span class="nb">bool</span><span class="o">&gt;</span> <span class="n">PasswordSignInAsync</span><span class="p">(</span><span class="n">string</span> <span class="n">tenant</span><span class="p">,</span> <span class="n">string</span> <span class="n">username</span><span class="p">,</span> <span class="n">string</span> <span class="n">password</span><span class="p">,</span> <span class="nb">bool</span> <span class="n">remember</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">var</span> <span class="n">user</span> <span class="o">=</span> <span class="k">await</span> <span class="p">(</span><span class="n">UserManager</span> <span class="k">as</span> <span class="n">ApplicationUserManager</span><span class="p">)</span><span class="o">.</span><span class="n">FindTenantUserAsync</span><span class="p">(</span><span class="n">tenant</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">user</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">await</span> <span class="n">SignInAsync</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">remember</span><span class="p">);</span>
                <span class="k">return</span> <span class="n">true</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">false</span><span class="p">;</span>
        <span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="account">
<h3><a class="toc-backref" href="#id44">Account</a><a class="headerlink" href="#account" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Open Areas\Identity\Pages\Account\Login.cshtml.cs</li>
<li>In Login POST method, implement the ApplicationSignInMangager/PasswordSigninAsync method as shown below.</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span>        public async Task&lt;IActionResult&gt; OnPostAsync(string returnUrl = null)
        {
            returnUrl = returnUrl ?? Url.Content(&quot;~/&quot;);

            if (ModelState.IsValid)
            {
                // This doesn&#39;t count login failures towards account lockout
                // To enable password failures to trigger account lockout, set lockoutOnFailure: true
<span class="hll">                var result = await _signInManager.PasswordSignInAsync(Input.Tenant, Input.Email, Input.Password, Input.RememberMe);
</span><span class="hll">                if (result)
</span><span class="hll">                {
</span><span class="hll">                    _logger.LogInformation(&quot;User logged in.&quot;);
</span><span class="hll">                    return LocalRedirect(returnUrl);
</span><span class="hll">                }
</span><span class="hll">                else
</span><span class="hll">                {
</span><span class="hll">                    ModelState.AddModelError(string.Empty, &quot;Invalid login attempt.&quot;);
</span><span class="hll">                    return Page();
</span><span class="hll">                }
</span>            }

            // If we got this far, something failed, redisplay form
            return Page();
        }
</pre></div>
</div>
</div>
<div class="section" id="userinfo">
<h3><a class="toc-backref" href="#id45">UserInfo</a><a class="headerlink" href="#userinfo" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Create Models\UserInfo.cs</li>
<li>Add the following:</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">namespace</span> <span class="n">MVCCoreStarterKit</span><span class="o">.</span><span class="n">Models</span>
<span class="p">{</span>
    <span class="n">public</span> <span class="k">class</span> <span class="nc">UserInfo</span>
    <span class="p">{</span>
        <span class="n">public</span> <span class="n">string</span> <span class="n">UserName</span> <span class="p">{</span> <span class="n">get</span><span class="p">;</span> <span class="nb">set</span><span class="p">;</span> <span class="p">}</span>

        <span class="o">//</span> <span class="n">This</span> <span class="n">corresponds</span> <span class="n">to</span> <span class="n">the</span> <span class="s1">&#39;TenantID&#39;</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">IzendaTenant</span> <span class="n">table</span>
        <span class="n">public</span> <span class="n">string</span> <span class="n">TenantUniqueName</span> <span class="p">{</span> <span class="n">get</span><span class="p">;</span> <span class="nb">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="inputmodel">
<h3><a class="toc-backref" href="#id46">InputModel</a><a class="headerlink" href="#inputmodel" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Open Areas\Identity\Pages\Account\Login.cshtml.cs and Areas\Identity\Pages\Account\Register.cshtml.cs</li>
<li>Add public class <code class="docutils literal"><span class="pre">InputModel</span></code> so that it appears as below.</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span>        <span class="n">public</span> <span class="k">class</span> <span class="nc">InputModel</span>
        <span class="p">{</span>
            <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
            <span class="p">[</span><span class="n">DataType</span><span class="p">(</span><span class="n">DataType</span><span class="o">.</span><span class="n">Text</span><span class="p">)]</span>
            <span class="n">public</span> <span class="n">string</span> <span class="n">Tenant</span> <span class="p">{</span> <span class="n">get</span><span class="p">;</span> <span class="nb">set</span><span class="p">;</span> <span class="p">}</span>

            <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
            <span class="p">[</span><span class="n">EmailAddress</span><span class="p">]</span>
            <span class="n">public</span> <span class="n">string</span> <span class="n">Email</span> <span class="p">{</span> <span class="n">get</span><span class="p">;</span> <span class="nb">set</span><span class="p">;</span> <span class="p">}</span>

            <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
            <span class="p">[</span><span class="n">DataType</span><span class="p">(</span><span class="n">DataType</span><span class="o">.</span><span class="n">Password</span><span class="p">)]</span>
            <span class="n">public</span> <span class="n">string</span> <span class="n">Password</span> <span class="p">{</span> <span class="n">get</span><span class="p">;</span> <span class="nb">set</span><span class="p">;</span> <span class="p">}</span>

            <span class="p">[</span><span class="n">Display</span><span class="p">(</span><span class="n">Name</span> <span class="o">=</span> <span class="s2">&quot;Remember me?&quot;</span><span class="p">)]</span>
            <span class="n">public</span> <span class="nb">bool</span> <span class="n">RememberMe</span> <span class="p">{</span> <span class="n">get</span><span class="p">;</span> <span class="nb">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="update-login-page">
<h3><a class="toc-backref" href="#id47">Update Login Page</a><a class="headerlink" href="#update-login-page" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Open Views\Account\Login.cshtml.</li>
<li>Replace the contents of this file with the following from the <a class="reference external" href="https://bitbucket.org/izenda-development/mvccorestarterkit/src/master/MVCCoreStarterKit/Areas/Identity/Pages/Account/Login.cshtml">GitHub MVCCoreStarterKit equivalent</a>. This will add a Tenant section to the login page.</li>
</ol>
<div class="highlight-default"><div class="highlight"><pre><span></span>            &lt;form id=&quot;account&quot; method=&quot;post&quot;&gt;
                &lt;h4&gt;Use a local account to log in.&lt;/h4&gt;
                &lt;hr /&gt;
                &lt;div asp-validation-summary=&quot;All&quot; class=&quot;text-danger&quot;&gt;&lt;/div&gt;
<span class="hll">                &lt;div class=&quot;form-group&quot;&gt;
</span><span class="hll">                    &lt;label asp-for=&quot;Input.Tenant&quot;&gt;&lt;/label&gt;
</span><span class="hll">                    &lt;input asp-for=&quot;Input.Tenant&quot; class=&quot;form-control&quot; /&gt;
</span><span class="hll">                    &lt;span asp-validation-for=&quot;Input.Tenant&quot; class=&quot;text-danger&quot;&gt;&lt;/span&gt;
</span><span class="hll">                &lt;/div&gt;
</span>                &lt;div class=&quot;form-group&quot;&gt;
                    &lt;label asp-for=&quot;Input.Email&quot;&gt;&lt;/label&gt;
                    &lt;input asp-for=&quot;Input.Email&quot; class=&quot;form-control&quot; /&gt;
                    &lt;span asp-validation-for=&quot;Input.Email&quot; class=&quot;text-danger&quot;&gt;&lt;/span&gt;
                &lt;/div&gt;
                &lt;div class=&quot;form-group&quot;&gt;
                    &lt;label asp-for=&quot;Input.Password&quot;&gt;&lt;/label&gt;
                    &lt;input asp-for=&quot;Input.Password&quot; class=&quot;form-control&quot; /&gt;
                    &lt;span asp-validation-for=&quot;Input.Password&quot; class=&quot;text-danger&quot;&gt;&lt;/span&gt;
                &lt;/div&gt;
                &lt;div class=&quot;form-group&quot;&gt;
                    &lt;div class=&quot;checkbox&quot;&gt;
                        &lt;label asp-for=&quot;Input.RememberMe&quot;&gt;
                            &lt;input asp-for=&quot;Input.RememberMe&quot; /&gt;
                            @Html.DisplayNameFor(m =&gt; m.Input.RememberMe)
                        &lt;/label&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;div class=&quot;form-group&quot;&gt;
                    &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;Log in&lt;/button&gt;
                &lt;/div&gt;
                &lt;div class=&quot;form-group&quot;&gt;
                    &lt;p&gt;
                        &lt;a id=&quot;forgot-password&quot; asp-page=&quot;./ForgotPassword&quot;&gt;Forgot your password?&lt;/a&gt;
                    &lt;/p&gt;
                    &lt;p&gt;
                        &lt;a asp-page=&quot;./Register&quot; asp-route-returnUrl=&quot;@Model.ReturnUrl&quot;&gt;Register as a new user&lt;/a&gt;
                    &lt;/p&gt;
                &lt;/div&gt;
            &lt;/form&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="run-first-login">
<h2><a class="toc-backref" href="#id48">Run First Login</a><a class="headerlink" href="#run-first-login" title="Permalink to this headline">¶</a></h2>
<p>Press F5 to run application, navigate to login page and enter the values below for the respective fields:</p>
<ul class="simple">
<li>Tenant = System</li>
<li>Email = <a class="reference external" href="mailto:IzendaAdmin&#37;&#52;&#48;system&#46;com">IzendaAdmin<span>&#64;</span>system<span>&#46;</span>com</a></li>
<li>Password = <a class="reference external" href="mailto:Izenda&#37;&#52;&#48;123">Izenda<span>&#64;</span>123</a></li>
</ul>
<p>Then click Login. You will see the home page with the logged in user’s email on top right of the page.</p>
<div class="figure" id="id9">
<a class="reference internal image-reference" href="../_images/mvc_current_user_ui.png"><img alt="../_images/mvc_current_user_ui.png" src="../_images/mvc_current_user_ui.png" style="width: 730px;" /></a>
<p class="caption"><span class="caption-text">Current user and Log off button</span></p>
</div>
</div>
<div class="section" id="update-shared-layout">
<h2><a class="toc-backref" href="#id49">Update Shared Layout</a><a class="headerlink" href="#update-shared-layout" title="Permalink to this headline">¶</a></h2>
<div class="section" id="construct-izenda-menu-items">
<h3><a class="toc-backref" href="#id50">Construct Izenda Menu Items</a><a class="headerlink" href="#construct-izenda-menu-items" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Open ~\Views\Shared\_Header.cshtml then add menu items for Izenda pages:</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="nd">@Html</span><span class="o">.</span><span class="n">ActionLink</span><span class="p">(</span><span class="s2">&quot;Izenda&quot;</span><span class="p">,</span> <span class="s2">&quot;Izenda&quot;</span><span class="p">,</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="n">new</span> <span class="p">{</span> <span class="nd">@class</span> <span class="o">=</span> <span class="s2">&quot;nav-link text-dark&quot;</span> <span class="p">})</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="nd">@Html</span><span class="o">.</span><span class="n">ActionLink</span><span class="p">(</span><span class="s2">&quot;Settings&quot;</span><span class="p">,</span> <span class="s2">&quot;Settings&quot;</span><span class="p">,</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="n">new</span> <span class="p">{</span> <span class="nd">@class</span> <span class="o">=</span> <span class="s2">&quot;nav-link text-dark&quot;</span> <span class="p">})</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="nd">@Html</span><span class="o">.</span><span class="n">ActionLink</span><span class="p">(</span><span class="s2">&quot;Mixed Parts&quot;</span><span class="p">,</span> <span class="s2">&quot;MixedParts&quot;</span><span class="p">,</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="n">new</span> <span class="p">{</span> <span class="nd">@class</span> <span class="o">=</span> <span class="s2">&quot;nav-link text-dark&quot;</span> <span class="p">})</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>

    <span class="o">@*</span> <span class="n">Reports</span> <span class="o">*@</span>
    <span class="o">&lt;</span><span class="n">li</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;nav-item dropdown&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">a</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;nav-link dropdown-toggle text-dark&quot;</span> <span class="n">data</span><span class="o">-</span><span class="n">toggle</span><span class="o">=</span><span class="s2">&quot;dropdown&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="o">&gt;</span>
            <span class="n">Reports</span>
            <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;caret&quot;</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">ul</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;dropdown-menu&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="nd">@Html</span><span class="o">.</span><span class="n">ActionLink</span><span class="p">(</span><span class="s2">&quot;New Report&quot;</span><span class="p">,</span> <span class="s2">&quot;ReportDesigner&quot;</span><span class="p">,</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="n">new</span> <span class="p">{</span> <span class="nd">@class</span> <span class="o">=</span> <span class="s2">&quot;nav-link text-dark&quot;</span> <span class="p">})</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="nd">@Html</span><span class="o">.</span><span class="n">ActionLink</span><span class="p">(</span><span class="s2">&quot;Report List&quot;</span><span class="p">,</span> <span class="s2">&quot;Reports&quot;</span><span class="p">,</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="n">new</span> <span class="p">{</span> <span class="nd">@class</span> <span class="o">=</span> <span class="s2">&quot;nav-link text-dark&quot;</span> <span class="p">})</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
            <span class="o">@*</span> <span class="n">Add</span> <span class="n">to</span> <span class="n">report</span> <span class="n">Viewer</span> <span class="n">to</span> <span class="n">Demo</span><span class="p">,</span> <span class="n">hardcode</span> <span class="n">Report</span> <span class="n">ID</span> <span class="n">to</span> <span class="n">link</span> <span class="n">user</span> <span class="n">to</span> <span class="n">a</span> <span class="n">specific</span> <span class="n">report</span> <span class="o">-</span> <span class="n">please</span> <span class="n">update</span> <span class="n">the</span> <span class="n">report</span> <span class="nb">id</span> <span class="k">with</span> <span class="n">one</span> <span class="n">created</span> <span class="ow">in</span> <span class="n">your</span> <span class="n">enviroment</span><span class="o">*@</span>
            <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="nd">@Html</span><span class="o">.</span><span class="n">ActionLink</span><span class="p">(</span><span class="s2">&quot;Report Viewer&quot;</span><span class="p">,</span> <span class="s2">&quot;ReportViewer&quot;</span><span class="p">,</span> <span class="s2">&quot;Report&quot;</span><span class="p">,</span> <span class="n">new</span> <span class="p">{</span> <span class="nb">id</span> <span class="o">=</span> <span class="s2">&quot;[your report id]&quot;</span> <span class="p">},</span> <span class="n">new</span> <span class="p">{</span> <span class="nd">@class</span> <span class="o">=</span> <span class="s2">&quot;nav-link text-dark&quot;</span> <span class="p">})</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="nd">@Html</span><span class="o">.</span><span class="n">ActionLink</span><span class="p">(</span><span class="s2">&quot;Report Parts&quot;</span><span class="p">,</span> <span class="s2">&quot;ReportParts&quot;</span><span class="p">,</span> <span class="s2">&quot;Report&quot;</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="n">new</span> <span class="p">{</span> <span class="nd">@class</span> <span class="o">=</span> <span class="s2">&quot;nav-link text-dark&quot;</span> <span class="p">})</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>

    <span class="o">@*</span> <span class="n">Dashboards</span> <span class="o">*@</span>
    <span class="o">&lt;</span><span class="n">li</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;nav-item dropdown&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">a</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;nav-link dropdown-toggle text-dark&quot;</span> <span class="n">data</span><span class="o">-</span><span class="n">toggle</span><span class="o">=</span><span class="s2">&quot;dropdown&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="o">&gt;</span>
            <span class="n">Dashboards</span>
            <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;caret&quot;</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">ul</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;dropdown-menu&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="nd">@Html</span><span class="o">.</span><span class="n">ActionLink</span><span class="p">(</span><span class="s2">&quot;New Dashboard&quot;</span><span class="p">,</span> <span class="s2">&quot;DashboardDesigner&quot;</span><span class="p">,</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="n">new</span> <span class="p">{</span> <span class="nd">@class</span> <span class="o">=</span> <span class="s2">&quot;nav-link text-dark&quot;</span> <span class="p">})</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="nd">@Html</span><span class="o">.</span><span class="n">ActionLink</span><span class="p">(</span><span class="s2">&quot;Dashboard List&quot;</span><span class="p">,</span> <span class="s2">&quot;Dashboards&quot;</span><span class="p">,</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="n">new</span> <span class="p">{</span> <span class="nd">@class</span> <span class="o">=</span> <span class="s2">&quot;nav-link text-dark&quot;</span> <span class="p">})</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
            <span class="o">@*</span> <span class="n">Add</span> <span class="n">to</span> <span class="n">report</span> <span class="n">Viewer</span> <span class="n">to</span> <span class="n">Demo</span><span class="p">,</span> <span class="n">hardcode</span> <span class="n">Report</span> <span class="n">ID</span> <span class="n">to</span> <span class="n">link</span> <span class="n">user</span> <span class="n">to</span> <span class="n">a</span> <span class="n">specific</span> <span class="n">report</span> <span class="o">-</span> <span class="n">please</span> <span class="n">update</span> <span class="n">the</span> <span class="n">report</span> <span class="nb">id</span> <span class="k">with</span> <span class="n">one</span> <span class="n">created</span> <span class="ow">in</span> <span class="n">your</span> <span class="n">enviroment</span><span class="o">*@</span>
            <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="nd">@Html</span><span class="o">.</span><span class="n">ActionLink</span><span class="p">(</span><span class="s2">&quot;Dashboard Viewer&quot;</span><span class="p">,</span> <span class="s2">&quot;DashboardViewer&quot;</span><span class="p">,</span> <span class="s2">&quot;Dashboard&quot;</span><span class="p">,</span> <span class="n">new</span> <span class="p">{</span> <span class="nb">id</span> <span class="o">=</span> <span class="s2">&quot;[your dashboard id]&quot;</span> <span class="p">},</span> <span class="n">new</span> <span class="p">{</span> <span class="nd">@class</span> <span class="o">=</span> <span class="s2">&quot;nav-link text-dark&quot;</span> <span class="p">})</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Open ~\Views\Shared\_Layout.cshtml then add the header for Izenda pages:</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="o">&lt;</span><span class="n">header</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;container-fluid&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;navbar-header&quot;</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">button</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;button&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;navbar-toggle&quot;</span> <span class="n">data</span><span class="o">-</span><span class="n">toggle</span><span class="o">=</span><span class="s2">&quot;collapse&quot;</span> <span class="n">data</span><span class="o">-</span><span class="n">target</span><span class="o">=</span><span class="s2">&quot;.navbar-collapse&quot;</span><span class="o">&gt;</span>
                        <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;icon-bar&quot;</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
                        <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;icon-bar&quot;</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
                        <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;icon-bar&quot;</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
                    <span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
                    <span class="nd">@Html</span><span class="o">.</span><span class="n">ActionLink</span><span class="p">(</span><span class="s2">&quot;MVCCore StarterKit&quot;</span><span class="p">,</span> <span class="s2">&quot;Index&quot;</span><span class="p">,</span> <span class="s2">&quot;Home&quot;</span><span class="p">,</span> <span class="n">new</span> <span class="p">{</span> <span class="n">area</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="p">},</span> <span class="n">new</span> <span class="p">{</span> <span class="nd">@class</span> <span class="o">=</span> <span class="s2">&quot;navbar-brand&quot;</span> <span class="p">})</span>
                <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="hll">                <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;navbar-collapse collapse d-sm-inline-flex flex-sm-row-reverse&quot;</span><span class="o">&gt;</span>
</span><span class="hll">                    <span class="o">&lt;</span><span class="n">ul</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;nav navbar-nav&quot;</span><span class="o">&gt;</span>
</span><span class="hll">                        <span class="o">&lt;</span><span class="n">partial</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;_Header&quot;</span> <span class="o">/&gt;</span>
</span><span class="hll">                    <span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
</span><span class="hll">                    <span class="o">&lt;</span><span class="n">partial</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;_LoginPartial&quot;</span> <span class="o">/&gt;</span>
</span><span class="hll">                <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span><span class="hll">            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</span>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">header</span><span class="o">&gt;</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<p>Note that the menu routing requires the creation of 2 new controllers: ReportController and DashboardController. These will be created in a later section.</p>
</div>
<div class="section" id="implement-izenda-configuration-initialization">
<h3><a class="toc-backref" href="#id51">Implement Izenda Configuration Initialization</a><a class="headerlink" href="#implement-izenda-configuration-initialization" title="Permalink to this headline">¶</a></h3>
<p>Add Javascript code below into the bottom of the _Layout.cshtml to initialize Izenda Config and sub menu dropdown display. The function DoIzendaConfig() is located in ~\wwwroot\js\izenda.integrate.js. It initializes main config value needed to run Izenda’s integrated UI such as API Service Url, the path of the Izenda embedded JavaScript package, custom CSS styling, Izenda UI routing config, and the request timeout.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    &lt;script type=&quot;text/javascript&quot;&gt;
        $(document).ready(function () {
            DoIzendaConfig();
            $(&#39;[data-toggle=&quot;tooltip&quot;]&#39;).tooltip();
            $(&#39;[data-toggle=&quot;dropdown&quot;]&#39;).dropdown();
            $(&quot;#reportPartLoader&quot;).hide();
            $(&quot;#reportPartLoaderText&quot;).hide();
        });
    &lt;/script&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="embedding-front-end-izenda-izenda-ui">
<h2><a class="toc-backref" href="#id52">Embedding Front-end Izenda (Izenda UI)</a><a class="headerlink" href="#embedding-front-end-izenda-izenda-ui" title="Permalink to this headline">¶</a></h2>
<div class="section" id="embedding-izenda-full-page">
<h3><a class="toc-backref" href="#id53">Embedding Izenda full page</a><a class="headerlink" href="#embedding-izenda-full-page" title="Permalink to this headline">¶</a></h3>
<p>In the HomeController add a new action named Izenda and then create the view Izenda.cshtml for it.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>        <span class="n">public</span> <span class="n">ActionResult</span> <span class="n">Izenda</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">View</span><span class="p">();</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>This action is used to embedded the entire Izenda application into one view. The Izenda/* routes are subroutes inside of the fully embedded Izenda page.</p>
<p>In the Izenda.cshtml view, call function izendaInit(), which is defined in ~\Scripts\izenda.integrate.js. The full Izenda UI will be rendered when opening this page, including Report, Dashboard and Setting page.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>
@{
    ViewBag.Title = &quot;Izenda&quot;;
}

@*@section title{ Izenda }*@
@*@section customHeader{}*@
@section scripts
{
    &lt;script type=&quot;text/javascript&quot;&gt;
        $(document).ready(function () {
            izendaInit();
        });
    &lt;/script&gt;
}
&lt;div class=&quot;loader&quot; id=&quot;progressLoader&quot;&gt; &lt;/div&gt;
&lt;div class=&quot;izenda-container&quot; id=&quot;izenda-root&quot;&gt;&lt;/div&gt;

</pre></div>
</div>
<p>We have 2 empty div elements for each Izenda page, the <code class="docutils literal"><span class="pre">loader</span></code> div is used for display progress bar when the page is waiting for response from Izenda back-end, the div <code class="docutils literal"><span class="pre">izenda-container</span></code> is the container for Izenda page content.</p>
</div>
<div class="section" id="embedding-specific-izenda-pages">
<h3><a class="toc-backref" href="#id54">Embedding Specific Izenda Pages</a><a class="headerlink" href="#embedding-specific-izenda-pages" title="Permalink to this headline">¶</a></h3>
<div class="section" id="embedding-the-izenda-settings-page">
<h4><a class="toc-backref" href="#id55">Embedding the Izenda Settings Page</a><a class="headerlink" href="#embedding-the-izenda-settings-page" title="Permalink to this headline">¶</a></h4>
<p>Create the Settings action in the HomeController</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>        <span class="n">public</span> <span class="n">ActionResult</span> <span class="n">Settings</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">View</span><span class="p">();</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>The settings page view Settings.cshtml:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>
@{
    ViewBag.Title = &quot;Settings&quot;;
}

@*@section title{ Izenda }*@
@*@section customHeader{}*@
@section scripts
{
    &lt;script type=&quot;text/javascript&quot;&gt;
        $(document).ready(function () {
            izendaInitSetting();
        });
    &lt;/script&gt;
}
&lt;div class=&quot;loader&quot; id=&quot;progressLoader&quot;&gt; &lt;/div&gt;
&lt;div class=&quot;izenda-container&quot; id=&quot;izenda-root&quot;&gt;&lt;/div&gt;

</pre></div>
</div>
</div>
<div class="section" id="embedding-the-izenda-report-list-page">
<h4><a class="toc-backref" href="#id56">Embedding the Izenda Report List Page</a><a class="headerlink" href="#embedding-the-izenda-report-list-page" title="Permalink to this headline">¶</a></h4>
<p>Create the Reports action in HomeController</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>        <span class="n">public</span> <span class="n">ActionResult</span> <span class="n">Reports</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">View</span><span class="p">();</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>The report list view Reports.cshtml:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>
@{
    ViewBag.Title = &quot;Reports&quot;;
}

@*@section title{ Izenda }*@
@*@section customHeader{}*@
@section scripts
{
    &lt;script type=&quot;text/javascript&quot;&gt;
        $(document).ready(function () {
<span class="hll">            izendaInitReport();
</span>        });
    &lt;/script&gt;
}
&lt;div class=&quot;loader&quot; id=&quot;progressLoader&quot;&gt; &lt;/div&gt;
&lt;div class=&quot;izenda-container&quot; id=&quot;izenda-root&quot;&gt;&lt;/div&gt;

</pre></div>
</div>
</div>
<div class="section" id="embedding-the-izenda-report-designer-page">
<h4><a class="toc-backref" href="#id57">Embedding the Izenda Report Designer Page</a><a class="headerlink" href="#embedding-the-izenda-report-designer-page" title="Permalink to this headline">¶</a></h4>
<p>Create the ReportDesigner action in HomeController</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>        <span class="n">public</span> <span class="n">ActionResult</span> <span class="n">ReportDesigner</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">View</span><span class="p">();</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>The report designer view ReportDesigner.cshtml:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>
@{
    ViewBag.Title = &quot;Report Designer&quot;;
}

@*@section title{ Izenda }*@
@*@section customHeader{}*@
@section scripts
{
    &lt;script type=&quot;text/javascript&quot;&gt;
        $(document).ready(function () {
<span class="hll">            izendaInitReportDesigner();
</span>        });
    &lt;/script&gt;
}
&lt;div class=&quot;loader&quot; id=&quot;progressLoader&quot;&gt; &lt;/div&gt;
&lt;div class=&quot;izenda-container&quot; id=&quot;izenda-root&quot;&gt;&lt;/div&gt;

</pre></div>
</div>
</div>
<div class="section" id="report-part-for-exporting">
<h4><a class="toc-backref" href="#id58">Report Part for Exporting</a><a class="headerlink" href="#report-part-for-exporting" title="Permalink to this headline">¶</a></h4>
<p>This action is not displayed directly to the end-users. It is used for rendering report parts (charts, gauges, and maps) for exporting. Reports containing these report part types must be rendered to capture html content then converted it to image when creating exported material (pdf, word, excel, etc.).</p>
<p>This view is requested by Izenda backend over the route url <code class="docutils literal"><span class="pre">viewer/reportpart/{id}</span></code> in route config ~\View_Start\RouteConfig.cs.</p>
<p>Add the ReportPart action in HomeController:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>        <span class="n">public</span> <span class="n">ActionResult</span> <span class="n">ReportPart</span><span class="p">(</span><span class="n">Guid</span> <span class="nb">id</span><span class="p">,</span> <span class="n">string</span> <span class="n">token</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ViewBag</span><span class="o">.</span><span class="n">Id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">;</span>
            <span class="n">ViewBag</span><span class="o">.</span><span class="n">Token</span> <span class="o">=</span> <span class="n">token</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">View</span><span class="p">();</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>This view is only used by Izenda backend, so it requires a minimal view containing only the report part content. Create a new simple layout named <code class="docutils literal"><span class="pre">_IzendaLayout.cshtml</span></code>. This layout does not contain UI for menu item, signed in user information.</p>
<p>The <code class="docutils literal"><span class="pre">_IzendaLayout.cshtml</span></code> content:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;@ViewBag.Title - My ASP.NET Application&lt;/title&gt;
    @Styles.Render(&quot;~/Content/css&quot;)
    @Scripts.Render(&quot;~/bundles/modernizr&quot;)

    @* Apply css based on the users tenant *@
    &lt;link href=&quot;~/Scripts/izenda/izenda-ui.css&quot; rel=&quot;stylesheet&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class=&quot;container-fluid body-content&quot;&gt;
        @RenderBody()
    &lt;/div&gt;

    @Scripts.Render(&quot;~/bundles/jquery&quot;)
    @Scripts.Render(&quot;~/bundles/bootstrap&quot;)


    @* #izenda *@
    &lt;script src=&quot;~/Scripts/alertify.js&quot;&gt;&lt;/script&gt;
    @Scripts.Render(&quot;~/bundles/izenda&quot;)

    &lt;script type=&quot;text/javascript&quot;&gt;
        $(document).ready(function () {
            DoIzendaConfig();
            $(&#39;[data-toggle=&quot;tooltip&quot;]&#39;).tooltip();
            $(&#39;[data-toggle=&quot;dropdown&quot;]&#39;).dropdown();
            $(&quot;#reportPartLoader&quot;).hide();
            $(&quot;#reportPartLoaderText&quot;).hide();
        });
    &lt;/script&gt;
    @RenderSection(&quot;scripts&quot;, required: false)
&lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
<p>The ReportPart.cshtml content:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>@{
    Layout = &quot;~/Views/Shared/Izenda_Layout.cshtml&quot;;
    ViewBag.Title = &quot;Report Viewer&quot;;
}
@section scripts
{
    &lt;script type=&quot;text/javascript&quot;&gt;
        $(document).ready(function () {
<span class="hll">            izendaInitReportPartExportViewer(&#39;@ViewBag.Id&#39;, &#39;@ViewBag.Token&#39;);
</span>           // $(&#39;#izenda-root&#39;).children().first().removeClass(&#39;izenda&#39;);
            //var classList = $(&#39;#izenda-root&#39;).children().first().attr(&#39;class&#39;).split(/\s+/);
            //$.each(classList, function (index, item) {
            //    console.log(item);
            //});

        });
    &lt;/script&gt;
}
&lt;style&gt;
    #izenda-root &gt; .izenda {
        background-color: transparent !important;
    }
&lt;/style&gt;
&lt;div class=&quot;izenda-container&quot; id=&quot;izenda-root&quot; style=&quot;margin-top:0px;&quot;&gt;&lt;/div&gt;

</pre></div>
</div>
</div>
<div class="section" id="embedding-the-report-viewer">
<h4><a class="toc-backref" href="#id59">Embedding the Report Viewer</a><a class="headerlink" href="#embedding-the-report-viewer" title="Permalink to this headline">¶</a></h4>
<p>Create the ReportController and add a new action named ReportViewer:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>        <span class="o">//</span> <span class="n">show</span> <span class="n">report</span> <span class="n">Viewer</span> <span class="n">by</span> <span class="nb">id</span>
        <span class="n">public</span> <span class="n">ActionResult</span> <span class="n">ReportViewer</span><span class="p">(</span><span class="n">string</span> <span class="nb">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">ViewBag</span><span class="o">.</span><span class="n">Id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">;</span>
            <span class="k">return</span> <span class="n">View</span><span class="p">();</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>Create the view ReportViewer.cshtml:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>@{
    ViewBag.Title = &quot;Report Viewer&quot;;
}
@section scripts
    {
    &lt;script type=&quot;text/javascript&quot;&gt;
    $(document).ready(function () {
        var overridingFilterQueries = JSON.parse(&#39;@Html.Raw(System.Net.WebUtility.HtmlDecode(ViewBag.overridingFilterQueries))&#39;);
        izendaInitReportViewer(&#39;@ViewBag.Id&#39;, {
<span class="hll">          overridingFilterValue: overridingFilterQueries
</span>        }
      );
    });
    &lt;/script&gt;
}
&lt;div class=&quot;loader&quot; id=&quot;progressLoader&quot;&gt; &lt;/div&gt;
&lt;div class=&quot;izenda-container&quot; id=&quot;izenda-root&quot;&gt;&lt;/div&gt;
</pre></div>
</div>
<p>Note that this page also used by Izenda backend in function to export report html content when user wants to send a report via email (directly or over subscription scheduler). The Izenda backend uses the route <code class="docutils literal"><span class="pre">report/view/{id}</span></code> to get report content, then in RouteConfig.cs we have a custom route for this. You must ensure your report viewer page has the same controller and action with the custom route <code class="docutils literal"><span class="pre">ReportViewer</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>            <span class="n">routes</span><span class="o">.</span><span class="n">MapRoute</span><span class="p">(</span>
                <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;ReportViewer&quot;</span><span class="p">,</span>
                <span class="n">url</span><span class="p">:</span> <span class="s2">&quot;report/view/</span><span class="si">{id}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">defaults</span><span class="p">:</span> <span class="n">new</span> <span class="p">{</span> <span class="n">controller</span> <span class="o">=</span> <span class="s2">&quot;Report&quot;</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="s2">&quot;ReportViewer&quot;</span> <span class="p">}</span>
            <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="embedding-report-parts">
<h4><a class="toc-backref" href="#id60">Embedding Report Parts</a><a class="headerlink" href="#embedding-report-parts" title="Permalink to this headline">¶</a></h4>
<p>This page demonstrates how to display multiple report parts on a page outside of the Report Viewer.  The function <code class="docutils literal"><span class="pre">izendaInitReportPartDemo</span></code> in ~\wwwroot\js\izenda.integrate.js is implemented to handle this.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Render</span> <span class="n">report</span> <span class="n">parts</span> <span class="n">to</span> <span class="n">specific</span> <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span> <span class="n">tag</span> <span class="n">by</span> <span class="n">report</span> <span class="n">part</span> <span class="nb">id</span>
<span class="n">var</span> <span class="n">izendaInitReportPartDemo</span> <span class="o">=</span> <span class="n">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="n">function</span> <span class="n">successFunc</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">console</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
        <span class="n">var</span> <span class="n">currentUserContext</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">token</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">token</span>
        <span class="p">};</span>

        <span class="o">//</span> <span class="n">You</span> <span class="n">can</span> <span class="n">add</span> <span class="n">report</span> <span class="n">parts</span> <span class="n">after</span> <span class="n">creating</span> <span class="n">reports</span> <span class="n">using</span> <span class="n">the</span> <span class="n">context</span> <span class="n">below</span> 
        <span class="o">//</span> <span class="n">Add</span> <span class="n">the</span> <span class="n">report</span> <span class="n">part</span> <span class="n">ID</span><span class="s1">&#39;s in the [your report nth id] area</span>
        <span class="n">IzendaSynergy</span><span class="o">.</span><span class="n">setCurrentUserContext</span><span class="p">(</span><span class="n">currentUserContext</span><span class="p">);</span>
        <span class="n">IzendaSynergy</span><span class="o">.</span><span class="n">renderReportPart</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s1">&#39;izenda-report-part1&#39;</span><span class="p">),</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;[your report 1st id]&quot;</span><span class="p">,</span>
        <span class="p">});</span>

        <span class="n">IzendaSynergy</span><span class="o">.</span><span class="n">renderReportPart</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s1">&#39;izenda-report-part2&#39;</span><span class="p">),</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;[your report 2nd id]&quot;</span><span class="p">,</span>
        <span class="p">});</span>
 
        <span class="n">IzendaSynergy</span><span class="o">.</span><span class="n">renderReportPart</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">getElementById</span><span class="p">(</span><span class="s1">&#39;izenda-report-part3&#39;</span><span class="p">),</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">[</span><span class="n">your</span> <span class="n">report</span> <span class="mi">3</span><span class="n">rd</span> <span class="nb">id</span><span class="p">]</span><span class="s2">&quot;</span>
        <span class="p">});</span>
    <span class="p">}</span>
    <span class="n">this</span><span class="o">.</span><span class="n">DoRender</span><span class="p">(</span><span class="n">successFunc</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
<p>In the ReportController create the action ReportParts:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>        <span class="n">public</span> <span class="n">ActionResult</span> <span class="n">ReportParts</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">View</span><span class="p">();</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>Create the ReportParts.cshtml view:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>@{
    ViewBag.Title = &quot;Report Parts&quot;;
}

@section scripts
    {
    &lt;script type=&quot;text/javascript&quot;&gt;
        $(document).ready(function () {
<span class="hll">            izendaInitReportPartDemo();
</span>        });
    &lt;/script&gt;
}
&lt;style&gt;
    .report-part-chart {
        float: left;
        width: 40%;
        height: 40%;
        margin-left: 20px;
        margin-top: 20px;
        background-color: white;
    }

    .report-part-grid {
        float: left;
        width: 40%;
        height: 50%;
        margin-left: 20px;
        margin-top: 20px;
        background-color: white;
    }
&lt;/style&gt;

&lt;div class=&quot;loader&quot; id=&quot;reportPartLoader&quot;&gt; &lt;/div&gt;
&lt;div class=&quot;izenda-container&quot;&gt;
    &lt;div class=&quot;report-part-chart&quot; id=&quot;izenda-report-part1&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;report-part-chart&quot; id=&quot;izenda-report-part2&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;report-part-grid&quot; id=&quot;izenda-report-part3&quot;&gt;&lt;/div&gt;
&lt;/div&gt;

</pre></div>
</div>
</div>
</div>
<div class="section" id="embedding-the-dashboard">
<h3><a class="toc-backref" href="#id61">Embedding the Dashboard</a><a class="headerlink" href="#embedding-the-dashboard" title="Permalink to this headline">¶</a></h3>
<div class="section" id="dashboard-list">
<h4><a class="toc-backref" href="#id62">Dashboard List</a><a class="headerlink" href="#dashboard-list" title="Permalink to this headline">¶</a></h4>
<p>This page displays the dashboard list.</p>
<p>In the HomeController create the action Dashboards:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>        <span class="n">public</span> <span class="n">ActionResult</span> <span class="n">Dashboards</span><span class="p">()</span>
        <span class="p">{</span> 
            <span class="k">return</span> <span class="n">View</span><span class="p">();</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>Create the Dashboards.cshtml view:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>@{
    ViewBag.Title = &quot;Dashboards&quot;;
}

@*@section title{ Izenda }*@
@*@section customHeader{}*@
@section scripts
{

    &lt;script type=&quot;text/javascript&quot;&gt;
        $(document).ready(function () {
<span class="hll">            izendaInitDashboard();
</span>        });
    &lt;/script&gt;
}

&lt;div class=&quot;loader&quot; id=&quot;progressLoader&quot;&gt; &lt;/div&gt;
&lt;div class=&quot;izenda-container&quot; id=&quot;izenda-root&quot;&gt;&lt;/div&gt;
</pre></div>
</div>
</div>
<div class="section" id="new-dashboard">
<h4><a class="toc-backref" href="#id63">New Dashboard</a><a class="headerlink" href="#new-dashboard" title="Permalink to this headline">¶</a></h4>
<p>The page for creating a new dashboard.</p>
<p>In the HomeController create the action DashboardDesigner:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>        <span class="n">public</span> <span class="n">ActionResult</span> <span class="n">DashboardDesigner</span><span class="p">()</span>
        <span class="p">{</span> 
            <span class="k">return</span> <span class="n">View</span><span class="p">();</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>Create the DashboardDesigner.cshtml view:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>@{
    ViewBag.Title = &quot;Dashboard Designer&quot;;
}

@section scripts
{
    &lt;script type=&quot;text/javascript&quot;&gt;
        $(document).ready(function () {
<span class="hll">            izendaInitNewDashboard();
</span>        });
    &lt;/script&gt;
}

&lt;div class=&quot;loader&quot; id=&quot;progressLoader&quot;&gt; &lt;/div&gt;
&lt;div class=&quot;izenda-container&quot; id=&quot;izenda-root&quot;&gt;&lt;/div&gt;
</pre></div>
</div>
</div>
<div class="section" id="dashboard-viewer">
<h4><a class="toc-backref" href="#id64">Dashboard Viewer</a><a class="headerlink" href="#dashboard-viewer" title="Permalink to this headline">¶</a></h4>
<p>Display detail of dashboard, this page also is requested by Izenda backend for dashboard exporting function over route <code class="docutils literal"><span class="pre">dashboard/view/{id}</span></code>. In RouteConfig.cs we have a custom route named <code class="docutils literal"><span class="pre">DashboardViewer</span></code>, this custom route will map to the controller and view of this page.</p>
<p>Create the DashboardController and action DashboardViewer:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">using</span> <span class="n">Microsoft</span><span class="o">.</span><span class="n">AspNetCore</span><span class="o">.</span><span class="n">Mvc</span><span class="p">;</span>
<span class="n">using</span> <span class="n">MVCCoreStarterKit</span><span class="o">.</span><span class="n">Attributes</span><span class="p">;</span>
<span class="n">using</span> <span class="n">Newtonsoft</span><span class="o">.</span><span class="n">Json</span><span class="p">;</span>
<span class="n">using</span> <span class="n">System</span><span class="p">;</span>
<span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Collections</span><span class="o">.</span><span class="n">Generic</span><span class="p">;</span>

<span class="n">namespace</span> <span class="n">MVCCoreStarterKit</span><span class="o">.</span><span class="n">Controllers</span>
<span class="p">{</span>
    <span class="n">public</span> <span class="k">class</span> <span class="nc">DashboardController</span> <span class="p">:</span> <span class="n">Controller</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="n">Theme</span><span class="p">]</span>
        <span class="n">public</span> <span class="n">IActionResult</span> <span class="n">DashboardViewer</span><span class="p">(</span><span class="n">string</span> <span class="nb">id</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">var</span> <span class="n">query</span> <span class="o">=</span> <span class="n">Request</span><span class="o">.</span><span class="n">Query</span><span class="p">;</span>
            <span class="n">dynamic</span> <span class="n">filters</span> <span class="o">=</span> <span class="n">new</span> <span class="n">System</span><span class="o">.</span><span class="n">Dynamic</span><span class="o">.</span><span class="n">ExpandoObject</span><span class="p">();</span>
            <span class="n">foreach</span> <span class="p">(</span><span class="n">string</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">Keys</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="p">((</span><span class="n">IDictionary</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">Object</span><span class="o">&gt;</span><span class="p">)</span><span class="n">filters</span><span class="p">)</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">query</span><span class="p">[</span><span class="n">key</span><span class="p">]);</span>
            <span class="p">}</span>

            <span class="n">ViewBag</span><span class="o">.</span><span class="n">Id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">;</span>
            <span class="n">ViewBag</span><span class="o">.</span><span class="n">filters</span> <span class="o">=</span> <span class="n">JsonConvert</span><span class="o">.</span><span class="n">SerializeObject</span><span class="p">(</span><span class="n">filters</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">View</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Create the DashboardViewer.cshtml view:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>@{
    ViewBag.Title = &quot;Dashboard Viewer&quot;;
}

@section scripts
    {
    &lt;script type=&quot;text/javascript&quot;&gt;
        $(document).ready(function () {
            var filters = JSON.parse(&#39;@Html.Raw(System.Net.WebUtility.HtmlDecode(ViewBag.filters))&#39;);
<span class="hll">            izendaInitDashboardViewer(&#39;@ViewBag.Id&#39;, filters);
</span>        });
    &lt;/script&gt;
}

&lt;div class=&quot;loader&quot; id=&quot;progressLoader&quot;&gt; &lt;/div&gt;
&lt;div class=&quot;izenda-container&quot; id=&quot;izenda-root&quot;&gt;&lt;/div&gt;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="run-your-izenda-integrated-application">
<h2><a class="toc-backref" href="#id65">Run Your Izenda Integrated Application</a><a class="headerlink" href="#run-your-izenda-integrated-application" title="Permalink to this headline">¶</a></h2>
<p>Press F5 to run debug</p>
<p>Navigate to login page and enter the values below for the respective fields:</p>
<ul class="simple">
<li>Tenant = System</li>
<li>Email = <a class="reference external" href="mailto:IzendaAdmin&#37;&#52;&#48;system&#46;com">IzendaAdmin<span>&#64;</span>system<span>&#46;</span>com</a></li>
<li>Password = <a class="reference external" href="mailto:Izenda&#37;&#52;&#48;123">Izenda<span>&#64;</span>123</a></li>
</ul>
<p>On top menu click Settings link then add your license key</p>
<div class="figure" id="id10">
<a class="reference internal image-reference" href="../_images/mvc_license_key.png"><img alt="../_images/mvc_license_key.png" src="../_images/mvc_license_key.png" style="width: 900px;" /></a>
<p class="caption"><span class="caption-text">Settings license key</span></p>
</div>
<p>Stop your application and start again (this step ensures Izenda reloads the cache).</p>
<p>Click Izenda link on top menu to open full Izenda app</p>
<div class="figure" id="id11">
<a class="reference internal image-reference" href="../_images/mvc_full_izenda_app.png"><img alt="../_images/mvc_full_izenda_app.png" src="../_images/mvc_full_izenda_app.png" style="width: 900px;" /></a>
<p class="caption"><span class="caption-text">Full Izenda app</span></p>
</div>
<p>Now feel free to explore Izenda integrated application.</p>
</div>
<div class="section" id="implement-register-new-account">
<h2><a class="toc-backref" href="#id66">Implement Register New Account</a><a class="headerlink" href="#implement-register-new-account" title="Permalink to this headline">¶</a></h2>
<p>Modify register new user layout in ASP.NET MVC Core</p>
<div class="figure" id="id12">
<a class="reference internal image-reference" href="../_images/mvc_new_account.png"><img alt="../_images/mvc_new_account.png" src="../_images/mvc_new_account.png" style="width: 900px;" /></a>
<p class="caption"><span class="caption-text">New account screen</span></p>
</div>
<p>Add new class InputModel in ~\Areas\Identity\Pages\Account\Register.cshtml.cs</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>        <span class="n">public</span> <span class="k">class</span> <span class="nc">InputModel</span>
        <span class="p">{</span>
            <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
            <span class="p">[</span><span class="n">DataType</span><span class="p">(</span><span class="n">DataType</span><span class="o">.</span><span class="n">Text</span><span class="p">)]</span>
            <span class="p">[</span><span class="n">Display</span><span class="p">(</span><span class="n">Name</span> <span class="o">=</span> <span class="s2">&quot;Tenant&quot;</span><span class="p">)]</span>
            <span class="n">public</span> <span class="n">string</span> <span class="n">Tenant</span> <span class="p">{</span> <span class="n">get</span><span class="p">;</span> <span class="nb">set</span><span class="p">;</span> <span class="p">}</span>

            <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
            <span class="p">[</span><span class="n">EmailAddress</span><span class="p">]</span>
            <span class="p">[</span><span class="n">Display</span><span class="p">(</span><span class="n">Name</span> <span class="o">=</span> <span class="s2">&quot;Email&quot;</span><span class="p">)]</span>
            <span class="n">public</span> <span class="n">string</span> <span class="n">Email</span> <span class="p">{</span> <span class="n">get</span><span class="p">;</span> <span class="nb">set</span><span class="p">;</span> <span class="p">}</span>

            <span class="p">[</span><span class="n">Required</span><span class="p">]</span>
            <span class="p">[</span><span class="n">StringLength</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s2">&quot;The </span><span class="si">{0}</span><span class="s2"> must be at least </span><span class="si">{2}</span><span class="s2"> and at max </span><span class="si">{1}</span><span class="s2"> characters long.&quot;</span><span class="p">,</span> <span class="n">MinimumLength</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)]</span>
            <span class="p">[</span><span class="n">DataType</span><span class="p">(</span><span class="n">DataType</span><span class="o">.</span><span class="n">Password</span><span class="p">)]</span>
            <span class="p">[</span><span class="n">Display</span><span class="p">(</span><span class="n">Name</span> <span class="o">=</span> <span class="s2">&quot;Password&quot;</span><span class="p">)]</span>
            <span class="n">public</span> <span class="n">string</span> <span class="n">Password</span> <span class="p">{</span> <span class="n">get</span><span class="p">;</span> <span class="nb">set</span><span class="p">;</span> <span class="p">}</span>

            <span class="p">[</span><span class="n">DataType</span><span class="p">(</span><span class="n">DataType</span><span class="o">.</span><span class="n">Password</span><span class="p">)]</span>
            <span class="p">[</span><span class="n">Display</span><span class="p">(</span><span class="n">Name</span> <span class="o">=</span> <span class="s2">&quot;Confirm password&quot;</span><span class="p">)]</span>
            <span class="p">[</span><span class="n">Compare</span><span class="p">(</span><span class="s2">&quot;Password&quot;</span><span class="p">,</span> <span class="n">ErrorMessage</span> <span class="o">=</span> <span class="s2">&quot;The password and confirmation password do not match.&quot;</span><span class="p">)]</span>
            <span class="n">public</span> <span class="n">string</span> <span class="n">ConfirmPassword</span> <span class="p">{</span> <span class="n">get</span><span class="p">;</span> <span class="nb">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>Add new tenant input element into ~\Areas\Identity\Pages\Account\Register.cshtml</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-4&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">form</span> <span class="n">asp</span><span class="o">-</span><span class="n">route</span><span class="o">-</span><span class="n">returnUrl</span><span class="o">=</span><span class="s2">&quot;@Model.ReturnUrl&quot;</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span><span class="n">Create</span> <span class="n">a</span> <span class="n">new</span> <span class="n">account</span><span class="o">.&lt;/</span><span class="n">h4</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">hr</span> <span class="o">/&gt;</span>
            <span class="o">&lt;</span><span class="n">div</span> <span class="n">asp</span><span class="o">-</span><span class="n">validation</span><span class="o">-</span><span class="n">summary</span><span class="o">=</span><span class="s2">&quot;All&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;text-danger&quot;</span><span class="o">&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-group&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">label</span> <span class="n">asp</span><span class="o">-</span><span class="k">for</span><span class="o">=</span><span class="s2">&quot;Input.Tenant&quot;</span><span class="o">&gt;&lt;/</span><span class="n">label</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nb">input</span> <span class="n">asp</span><span class="o">-</span><span class="k">for</span><span class="o">=</span><span class="s2">&quot;Input.Tenant&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-control&quot;</span> <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="n">span</span> <span class="n">asp</span><span class="o">-</span><span class="n">validation</span><span class="o">-</span><span class="k">for</span><span class="o">=</span><span class="s2">&quot;Input.Tenant&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;text-danger&quot;</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-group&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">label</span> <span class="n">asp</span><span class="o">-</span><span class="k">for</span><span class="o">=</span><span class="s2">&quot;Input.Email&quot;</span><span class="o">&gt;&lt;/</span><span class="n">label</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nb">input</span> <span class="n">asp</span><span class="o">-</span><span class="k">for</span><span class="o">=</span><span class="s2">&quot;Input.Email&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-control&quot;</span> <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="n">span</span> <span class="n">asp</span><span class="o">-</span><span class="n">validation</span><span class="o">-</span><span class="k">for</span><span class="o">=</span><span class="s2">&quot;Input.Email&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;text-danger&quot;</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-group&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">label</span> <span class="n">asp</span><span class="o">-</span><span class="k">for</span><span class="o">=</span><span class="s2">&quot;Input.Password&quot;</span><span class="o">&gt;&lt;/</span><span class="n">label</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nb">input</span> <span class="n">asp</span><span class="o">-</span><span class="k">for</span><span class="o">=</span><span class="s2">&quot;Input.Password&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-control&quot;</span> <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="n">span</span> <span class="n">asp</span><span class="o">-</span><span class="n">validation</span><span class="o">-</span><span class="k">for</span><span class="o">=</span><span class="s2">&quot;Input.Password&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;text-danger&quot;</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-group&quot;</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">label</span> <span class="n">asp</span><span class="o">-</span><span class="k">for</span><span class="o">=</span><span class="s2">&quot;Input.ConfirmPassword&quot;</span><span class="o">&gt;&lt;/</span><span class="n">label</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nb">input</span> <span class="n">asp</span><span class="o">-</span><span class="k">for</span><span class="o">=</span><span class="s2">&quot;Input.ConfirmPassword&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-control&quot;</span> <span class="o">/&gt;</span>
                <span class="o">&lt;</span><span class="n">span</span> <span class="n">asp</span><span class="o">-</span><span class="n">validation</span><span class="o">-</span><span class="k">for</span><span class="o">=</span><span class="s2">&quot;Input.ConfirmPassword&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;text-danger&quot;</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">button</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;btn btn-primary&quot;</span><span class="o">&gt;</span><span class="n">Register</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Create Services folder and Add new TenantManager class to project (~\Services\TenantManager.cs), this class is used to get Tenant and create new tenant info from your authentication DB.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">using</span> <span class="n">MVCCoreStarterKit</span><span class="o">.</span><span class="n">Areas</span><span class="o">.</span><span class="n">Identity</span><span class="o">.</span><span class="n">Model</span><span class="p">;</span>
<span class="n">using</span> <span class="n">MVCCoreStarterKit</span><span class="o">.</span><span class="n">Data</span><span class="p">;</span>
<span class="n">using</span> <span class="n">System</span><span class="p">;</span>
<span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Linq</span><span class="p">;</span>
<span class="n">using</span> <span class="n">System</span><span class="o">.</span><span class="n">Threading</span><span class="o">.</span><span class="n">Tasks</span><span class="p">;</span>

<span class="n">namespace</span> <span class="n">MVCCoreStarterKit</span><span class="o">.</span><span class="n">Services</span>
<span class="p">{</span>
    <span class="n">public</span> <span class="n">interface</span> <span class="n">ITenantManager</span>
    <span class="p">{</span>
        <span class="n">Tenant</span> <span class="n">GetTenantByName</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">);</span>
        <span class="n">Task</span><span class="o">&lt;</span><span class="n">Tenant</span><span class="o">&gt;</span> <span class="n">SaveTenantAsync</span><span class="p">(</span><span class="n">Tenant</span> <span class="n">tenant</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="k">class</span> <span class="nc">TenantManager</span> <span class="p">:</span> <span class="n">ITenantManager</span>
    <span class="p">{</span>
        <span class="n">private</span> <span class="n">readonly</span> <span class="n">ApplicationDbContext</span> <span class="n">dbContext</span><span class="p">;</span>

        <span class="n">public</span> <span class="n">TenantManager</span><span class="p">(</span><span class="n">ApplicationDbContext</span> <span class="n">dbContext</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">this</span><span class="o">.</span><span class="n">dbContext</span> <span class="o">=</span> <span class="n">dbContext</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">public</span> <span class="n">Tenant</span> <span class="n">GetTenantByName</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">var</span> <span class="n">tenant</span> <span class="o">=</span> <span class="n">dbContext</span><span class="o">.</span><span class="n">Tenants</span><span class="o">.</span><span class="n">Where</span><span class="p">(</span><span class="n">x</span> <span class="o">=&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">StringComparison</span><span class="o">.</span><span class="n">InvariantCultureIgnoreCase</span><span class="p">))</span><span class="o">.</span><span class="n">SingleOrDefault</span><span class="p">();</span>
            <span class="k">return</span> <span class="n">tenant</span><span class="p">;</span>
        <span class="p">}</span>


        <span class="n">public</span> <span class="k">async</span> <span class="n">Task</span><span class="o">&lt;</span><span class="n">Tenant</span><span class="o">&gt;</span> <span class="n">SaveTenantAsync</span><span class="p">(</span><span class="n">Tenant</span> <span class="n">tenant</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">dbContext</span><span class="o">.</span><span class="n">Tenants</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">tenant</span><span class="p">);</span>
            <span class="k">await</span> <span class="n">dbContext</span><span class="o">.</span><span class="n">SaveChangesAsync</span><span class="p">();</span>

            <span class="k">return</span> <span class="n">tenant</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Open Areas\Identity\Pages\Account\Register.cshtml.cs and modify <code class="docutils literal"><span class="pre">OnPostAsync</span></code> action  to handle new user registration logic.</p>
<p>When registering a new user the new user’s information is stored on both the authentication DB and the Izenda DB, following that we split the registration logic into the steps below:</p>
<ul class="simple">
<li>Save new Tenant if needed</li>
<li>Save User and Role in authentication DB</li>
<li>Save User and Role in Izenda DB</li>
<li>Sign in with new user</li>
</ul>
<p>All step are encapsulated in the Register action in AccountController.</p>
<p>Register tenant:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>                <span class="n">var</span> <span class="n">tenant</span> <span class="o">=</span> <span class="k">await</span> <span class="n">HandleTenant</span><span class="p">(</span><span class="n">Input</span><span class="o">.</span><span class="n">Tenant</span><span class="p">);</span>
</pre></div>
</div>
<p>Save user and role information into authentication DB:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>                <span class="n">var</span> <span class="n">user</span> <span class="o">=</span> <span class="n">new</span> <span class="n">IzendaUser</span> <span class="p">{</span> <span class="n">Tenant_Id</span> <span class="o">=</span> <span class="n">tenant</span><span class="o">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">UserName</span> <span class="o">=</span> <span class="n">Input</span><span class="o">.</span><span class="n">Email</span><span class="p">,</span> <span class="n">Email</span> <span class="o">=</span> <span class="n">Input</span><span class="o">.</span><span class="n">Email</span> <span class="p">};</span>
                <span class="n">var</span> <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">userManager</span><span class="o">.</span><span class="n">CreateAsync</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">Input</span><span class="o">.</span><span class="n">Password</span><span class="p">);</span>
                <span class="k">await</span> <span class="n">userManager</span><span class="o">.</span><span class="n">AddToRoleAsync</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">roleName</span><span class="p">);</span>
</pre></div>
</div>
<p>Save user and role into IzendaDB:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>                if (result.Succeeded)
                {
                    logger.LogInformation(&quot;User created a new account with password.&quot;);
                    //determine tenant
                    Tenants izendaTenant = null;
                    if (!IsSystemTenant(tenant.Name))
                    {
                        izendaTenant = new Tenants();
                        izendaTenant.Active = true;
                        izendaTenant.Deleted = false;

                        izendaTenant.Name = tenant.Name;
                        izendaTenant.TenantID = tenant.Name;
                        TenantIntegrationConfig.AddOrUpdateTenant(izendaTenant);
                    }

                    //determine roles
                    var roleDetail = new RoleDetail()
                    {
                        Name = roleName,
                        TenantUniqueName = tenant.Name,
                        Active = true,
                        Permission = new Izenda.BI.Framework.Models.Permissions.Permission(),
                    };

                    var izendaUser = new UserDetail()
                    {
                        UserName = user.Email,
                        EmailAddress = user.Email,
                        FirstName = &quot;John&quot;, //todo fix this
                        LastName = &quot;Doe&quot;,
                        TenantDisplayId = izendaTenant?.Name,
                        SystemAdmin = IsSystemTenant(tenant.Name),
                        Deleted = false,
                        Active = true,
                        Roles = new List&lt;Role&gt;()
                    };

                    izendaUser.Roles.Add(new Role()
                    {
                        Name = roleDetail.Name
                    });

                    RoleIntegrationConfig.AddOrUpdateRole(roleDetail);
                    UserIntegrationConfig.AddOrUpdateUser(izendaUser);
</pre></div>
</div>
<p>Login with newly created user:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>                    <span class="k">await</span> <span class="n">signInManager</span><span class="o">.</span><span class="n">SignInAsync</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">isPersistent</span><span class="p">:</span> <span class="n">false</span><span class="p">);</span>
                    <span class="k">return</span> <span class="n">LocalRedirect</span><span class="p">(</span><span class="n">returnUrl</span><span class="p">);</span>
</pre></div>
</div>
<p>You can refer to completed implementation of Register in Register.chtml.cs on Github <a class="reference external" href="https://bitbucket.org/izenda-development/mvccorestarterkit/src/master/MVCCoreStarterKit/Areas/Identity/Pages/Account/Register.cshtml.cs">here</a>.</p>
</div>
<div class="section" id="call-izenda-api-service-in-c">
<h2><a class="toc-backref" href="#id67">Call Izenda API Service in C#</a><a class="headerlink" href="#call-izenda-api-service-in-c" title="Permalink to this headline">¶</a></h2>
<p>On completed sample starter kit on Github, we provide an example demonstrating how to call Izenda API service in C# code, reference to the ~\IzendaBoundary\WebAPIService.cs and ~\IzendaBoundary\IzendaUtility.cs for more detail.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Izenda.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'3.10.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-75560-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-75560-1');
</script>



</body>
</html>